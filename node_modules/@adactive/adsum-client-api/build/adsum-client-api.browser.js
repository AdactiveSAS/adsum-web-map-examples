/**
 * Copyright (C) 2018 Adactive SAS
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.AdsumClientApi={})}(this,function(t){"use strict";"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function e(t,e){return t(e={exports:{}},e.exports),e.exports}var n,r=e(function(t,e){var n;t.exports=(n=n||function(t,e){var n=Object.create||function(){function t(){}return function(e){var n;return t.prototype=e,n=new t,t.prototype=null,n}}(),r={},o=r.lib={},i=o.Base={extend:function(t){var e=n(this);return t&&e.mixIn(t),e.hasOwnProperty("init")&&this.init!==e.init||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},s=o.WordArray=i.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=void 0!=e?e:4*t.length},toString:function(t){return(t||u).stringify(this)},concat:function(t){var e=this.words,n=t.words,r=this.sigBytes,o=t.sigBytes;if(this.clamp(),r%4)for(var i=0;i<o;i++){var s=n[i>>>2]>>>24-i%4*8&255;e[r+i>>>2]|=s<<24-(r+i)%4*8}else for(var i=0;i<o;i+=4)e[r+i>>>2]=n[i>>>2];return this.sigBytes+=o,this},clamp:function(){var e=this.words,n=this.sigBytes;e[n>>>2]&=4294967295<<32-n%4*8,e.length=t.ceil(n/4)},clone:function(){var t=i.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var n,r=[],o=function(e){var e=e,n=987654321,r=4294967295;return function(){var o=((n=36969*(65535&n)+(n>>16)&r)<<16)+(e=18e3*(65535&e)+(e>>16)&r)&r;return o/=4294967296,(o+=.5)*(t.random()>.5?1:-1)}},i=0;i<e;i+=4){var a=o(4294967296*(n||t.random()));n=987654071*a(),r.push(4294967296*a()|0)}return new s.init(r,e)}}),a=r.enc={},u=a.Hex={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],o=0;o<n;o++){var i=e[o>>>2]>>>24-o%4*8&255;r.push((i>>>4).toString(16)),r.push((15&i).toString(16))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r+=2)n[r>>>3]|=parseInt(t.substr(r,2),16)<<24-r%8*4;return new s.init(n,e/2)}},l=a.Latin1={stringify:function(t){for(var e=t.words,n=t.sigBytes,r=[],o=0;o<n;o++){var i=e[o>>>2]>>>24-o%4*8&255;r.push(String.fromCharCode(i))}return r.join("")},parse:function(t){for(var e=t.length,n=[],r=0;r<e;r++)n[r>>>2]|=(255&t.charCodeAt(r))<<24-r%4*8;return new s.init(n,e)}},c=a.Utf8={stringify:function(t){try{return decodeURIComponent(escape(l.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return l.parse(unescape(encodeURIComponent(t)))}},h=o.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=c.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var n=this._data,r=n.words,o=n.sigBytes,i=this.blockSize,a=4*i,u=o/a,l=(u=e?t.ceil(u):t.max((0|u)-this._minBufferSize,0))*i,c=t.min(4*l,o);if(l){for(var h=0;h<l;h+=i)this._doProcessBlock(r,h);var p=r.splice(0,l);n.sigBytes-=c}return new s.init(p,c)},clone:function(){var t=i.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0}),p=(o.Hasher=h.extend({cfg:i.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){t&&this._append(t);var e=this._doFinalize();return e},blockSize:16,_createHelper:function(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function(t){return function(e,n){return new p.HMAC.init(t,n).finalize(e)}}}),r.algo={});return r}(Math),n)}),o=e(function(t,e){var n,o,i,s,a,u,l;t.exports=(i=(o=n=r).lib,s=i.WordArray,a=i.Hasher,u=[],l=o.algo.SHA1=a.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(t,e){for(var n=this._hash.words,r=n[0],o=n[1],i=n[2],s=n[3],a=n[4],l=0;l<80;l++){if(l<16)u[l]=0|t[e+l];else{var c=u[l-3]^u[l-8]^u[l-14]^u[l-16];u[l]=c<<1|c>>>31}var h=(r<<5|r>>>27)+a+u[l];h+=l<20?1518500249+(o&i|~o&s):l<40?1859775393+(o^i^s):l<60?(o&i|o&s|i&s)-1894007588:(o^i^s)-899497514,a=s,s=i,i=o<<30|o>>>2,o=r,r=h}n[0]=n[0]+r|0,n[1]=n[1]+o|0,n[2]=n[2]+i|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0},_doFinalize:function(){var t=this._data,e=t.words,n=8*this._nDataBytes,r=8*t.sigBytes;return e[r>>>5]|=128<<24-r%32,e[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),e[15+(r+64>>>9<<4)]=n,t.sigBytes=4*e.length,this._process(),this._hash},clone:function(){var t=a.clone.call(this);return t._hash=this._hash.clone(),t}}),o.SHA1=a._createHelper(l),o.HmacSHA1=a._createHmacHelper(l),n.SHA1)}),i=e(function(t,e){var n;t.exports=(n=r,function(t){var e=n,r=e.lib,o=r.WordArray,i=r.Hasher,s=e.algo,a=[];!function(){for(var e=0;e<64;e++)a[e]=4294967296*t.abs(t.sin(e+1))|0}();var u=s.MD5=i.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,e){for(var n=0;n<16;n++){var r=e+n,o=t[r];t[r]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}var i=this._hash.words,s=t[e+0],u=t[e+1],f=t[e+2],_=t[e+3],y=t[e+4],d=t[e+5],g=t[e+6],v=t[e+7],m=t[e+8],w=t[e+9],b=t[e+10],O=t[e+11],k=t[e+12],P=t[e+13],E=t[e+14],C=t[e+15],j=i[0],T=i[1],V=i[2],N=i[3];T=p(T=p(T=p(T=p(T=h(T=h(T=h(T=h(T=c(T=c(T=c(T=c(T=l(T=l(T=l(T=l(T,V=l(V,N=l(N,j=l(j,T,V,N,s,7,a[0]),T,V,u,12,a[1]),j,T,f,17,a[2]),N,j,_,22,a[3]),V=l(V,N=l(N,j=l(j,T,V,N,y,7,a[4]),T,V,d,12,a[5]),j,T,g,17,a[6]),N,j,v,22,a[7]),V=l(V,N=l(N,j=l(j,T,V,N,m,7,a[8]),T,V,w,12,a[9]),j,T,b,17,a[10]),N,j,O,22,a[11]),V=l(V,N=l(N,j=l(j,T,V,N,k,7,a[12]),T,V,P,12,a[13]),j,T,E,17,a[14]),N,j,C,22,a[15]),V=c(V,N=c(N,j=c(j,T,V,N,u,5,a[16]),T,V,g,9,a[17]),j,T,O,14,a[18]),N,j,s,20,a[19]),V=c(V,N=c(N,j=c(j,T,V,N,d,5,a[20]),T,V,b,9,a[21]),j,T,C,14,a[22]),N,j,y,20,a[23]),V=c(V,N=c(N,j=c(j,T,V,N,w,5,a[24]),T,V,E,9,a[25]),j,T,_,14,a[26]),N,j,m,20,a[27]),V=c(V,N=c(N,j=c(j,T,V,N,P,5,a[28]),T,V,f,9,a[29]),j,T,v,14,a[30]),N,j,k,20,a[31]),V=h(V,N=h(N,j=h(j,T,V,N,d,4,a[32]),T,V,m,11,a[33]),j,T,O,16,a[34]),N,j,E,23,a[35]),V=h(V,N=h(N,j=h(j,T,V,N,u,4,a[36]),T,V,y,11,a[37]),j,T,v,16,a[38]),N,j,b,23,a[39]),V=h(V,N=h(N,j=h(j,T,V,N,P,4,a[40]),T,V,s,11,a[41]),j,T,_,16,a[42]),N,j,g,23,a[43]),V=h(V,N=h(N,j=h(j,T,V,N,w,4,a[44]),T,V,k,11,a[45]),j,T,C,16,a[46]),N,j,f,23,a[47]),V=p(V,N=p(N,j=p(j,T,V,N,s,6,a[48]),T,V,v,10,a[49]),j,T,E,15,a[50]),N,j,d,21,a[51]),V=p(V,N=p(N,j=p(j,T,V,N,k,6,a[52]),T,V,_,10,a[53]),j,T,b,15,a[54]),N,j,u,21,a[55]),V=p(V,N=p(N,j=p(j,T,V,N,m,6,a[56]),T,V,C,10,a[57]),j,T,g,15,a[58]),N,j,P,21,a[59]),V=p(V,N=p(N,j=p(j,T,V,N,y,6,a[60]),T,V,O,10,a[61]),j,T,f,15,a[62]),N,j,w,21,a[63]),i[0]=i[0]+j|0,i[1]=i[1]+T|0,i[2]=i[2]+V|0,i[3]=i[3]+N|0},_doFinalize:function(){var e=this._data,n=e.words,r=8*this._nDataBytes,o=8*e.sigBytes;n[o>>>5]|=128<<24-o%32;var i=t.floor(r/4294967296),s=r;n[15+(o+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),n[14+(o+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),e.sigBytes=4*(n.length+1),this._process();for(var a=this._hash,u=a.words,l=0;l<4;l++){var c=u[l];u[l]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}return a},clone:function(){var t=i.clone.call(this);return t._hash=this._hash.clone(),t}});function l(t,e,n,r,o,i,s){var a=t+(e&n|~e&r)+o+s;return(a<<i|a>>>32-i)+e}function c(t,e,n,r,o,i,s){var a=t+(e&r|n&~r)+o+s;return(a<<i|a>>>32-i)+e}function h(t,e,n,r,o,i,s){var a=t+(e^n^r)+o+s;return(a<<i|a>>>32-i)+e}function p(t,e,n,r,o,i,s){var a=t+(n^(e|~r))+o+s;return(a<<i|a>>>32-i)+e}e.MD5=i._createHelper(u),e.HmacMD5=i._createHmacHelper(u)}(Math),n.MD5)}),s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},c=function t(e,n,r){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,n,r)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(r):void 0},h=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},p=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},f=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&a.return&&a.return()}finally{if(o)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},y=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,t),this.fromJSON(e)}return u(t,[{key:"reset",value:function(){}},{key:"fromJSON",value:function(e){var n=this;this.reset(),Object.keys(e).forEach(function(r){n.hasOwnProperty(r)&&(n[r]instanceof t?n[r].fromJSON(e[r]):n[r]=e[r])})}},{key:"toJSON",value:function(){var e=this,n={};return Object.keys(this).forEach(function(r){e.hasOwnProperty(r)&&(e[r]instanceof t?n[r]=e[r].toJSON():n[r]=e[r])}),n}}]),t}(),d={ERROR:"error",WARN:"warn",INFO:"info",VERBOSE:"verbose",DEBUG:"debug",SILLY:"silly"},g=function(){function t(){a(this,t)}return u(t,[{key:"log",value:function(t,e,n){throw new Error("This is an interface")}},{key:"error",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.log(d.ERROR,t,e)}},{key:"warn",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.log(d.WARN,t,e)}},{key:"info",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.log(d.INFO,t,e)}},{key:"verbose",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.log(d.VERBOSE,t,e)}},{key:"debug",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.log(d.DEBUG,t,e)}},{key:"silly",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.log(d.SILLY,t,e)}}],[{key:"isValidLogger",value:function(t){var e={isValid:!0,reasons:[]};return"object"!=(void 0===t?"undefined":s(t))||null===t?(e.isValid=!1,e.reasons.push("Logger must be a not null object"),e):(Object.keys(d).forEach(function(n){var r=d[n];"function"!=typeof t[r]&&(e.isValid=!1,e.reasons.push("Logger must implement method "+r))}),e)}},{key:"_getLevelValue",value:function(t){switch(t){case d.ERROR:return 0;case d.WARN:return 1;case d.INFO:return 2;case d.VERBOSE:return 3;case d.DEBUG:return 4;case d.SILLY:return 5;default:return 2}}}]),t}(),v=(function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}h(e,g),u(e,[{key:"log",value:function(t,e){}}])}(),function(t){function e(t,n){var r;return a(this,e),(r=p(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))).logger=t,r.tag=n,r}return h(e,g),u(e,[{key:"log",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.logger.log(t,"["+this.tag+"]"+e,n)}}]),e}()),m=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d.WARN,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return a(this,e),(t=p(this,(e.__proto__||Object.getPrototypeOf(e)).call(this))).level=n,t.tag=r,t}return h(e,g),u(e,[{key:"log",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!(this.constructor._getLevelValue(this.level)<this.constructor._getLevelValue(t))){var r;r=null!==this.tag?"["+t+"]["+this.tag+"]: "+e:"["+t+"]: "+e,n?console.log(r,n):console.log(r)}}}]),e}(),w={DRAFT:"DRAFT",PUBLISHED:"PUBLISHED"},b=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,y),u(e,[{key:"reset",value:function(){this.endpoint=null,this.username=null,this.key=null,this.site=null,this.locale=null,this.state=w.PUBLISHED,this.logger=new m,this.cacheManager=null}},{key:"getEndpoint",value:function(){return this.constructor.formatApiEndpoint(this.endpoint)}},{key:"validate",value:function(){if("string"!=typeof this.endpoint)throw new TypeError("AdsumClientApi.Options.endpoint: Should be a string");if("string"!=typeof this.username)throw new TypeError("AdsumClientApi.Options.username: Should be a string");if("string"!=typeof this.key)throw new TypeError("AdsumClientApi.Options.key: Should be a string");if(!Number.isInteger(this.site))throw new TypeError("AdsumClientApi.Options.site: Should be an integer");if(this.site<=0)throw new TypeError("AdsumClientApi.Options.site: Should be positive");var t=g.isValidLogger(this.logger),e=t.isValid,n=t.reasons;if(!e)throw new TypeError(n.join(", "))}}],[{key:"getApiVersion",value:function(){return"2.3"}},{key:"formatApiEndpoint",value:function(t){return"/"!==t.charAt(t.length-1)?t+"/2.3":t+"2.3"}}]),e}(),O=e(function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}function o(t,e,r,o,i){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new function(t,e,n){this.fn=t,this.context=e,this.once=n||!1}(r,o||t,i),a=n?n+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],s]:t._events[a].push(s):(t._events[a]=s,t._eventsCount++),t}function i(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var t,r,o=[];if(0===this._eventsCount)return o;for(r in t=this._events)e.call(t,r)&&o.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},s.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var o=0,i=r.length,s=new Array(i);o<i;o++)s[o]=r[o].fn;return s},s.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},s.prototype.emit=function(t,e,r,o,i,s){var a=n?n+t:t;if(!this._events[a])return!1;var u,l,c=this._events[a],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,r),!0;case 4:return c.fn.call(c.context,e,r,o),!0;case 5:return c.fn.call(c.context,e,r,o,i),!0;case 6:return c.fn.call(c.context,e,r,o,i,s),!0}for(l=1,u=new Array(h-1);l<h;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var p,f=c.length;for(l=0;l<f;l++)switch(c[l].once&&this.removeListener(t,c[l].fn,void 0,!0),h){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,e);break;case 3:c[l].fn.call(c[l].context,e,r);break;case 4:c[l].fn.call(c[l].context,e,r,o);break;default:if(!u)for(p=1,u=new Array(h-1);p<h;p++)u[p-1]=arguments[p];c[l].fn.apply(c[l].context,u)}}return!0},s.prototype.on=function(t,e,n){return o(this,t,e,n,!1)},s.prototype.once=function(t,e,n){return o(this,t,e,n,!0)},s.prototype.removeListener=function(t,e,r,o){var s=n?n+t:t;if(!this._events[s])return this;if(!e)return i(this,s),this;var a=this._events[s];if(a.fn)a.fn!==e||o&&!a.once||r&&a.context!==r||i(this,s);else{for(var u=0,l=[],c=a.length;u<c;u++)(a[u].fn!==e||o&&!a[u].once||r&&a[u].context!==r)&&l.push(a[u]);l.length?this._events[s]=1===l.length?l[0]:l:i(this,s)}return this},s.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&i(this,e)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,t.exports=s}),k=(n=0,function(){return++n}),P=new WeakMap,E=new O,C=function(){function t(){throw a(this,t),new Error("EventDispatcher couldn't be instantiated")}return u(t,null,[{key:"_getObjectId",value:function(t){return P.has(t)||P.set(t,k()),P.get(t)}},{key:"_getUniversalEventName",value:function(t,e){return t.constructor.name+e+this._getObjectId(t)}},{key:"subscribe",value:function(t,e,n){var r=this._getUniversalEventName(t,e);E.on(r,n)}},{key:"unsubscribe",value:function(t,e,n){var r=this._getUniversalEventName(t,e);E.removeListener(r,n)}},{key:"publish",value:function(t,e,n){E.emit(this._getUniversalEventName(t,e),n)}}]),t}(),j={CREATE:"CREATE",UPDATE:"UPDATE",REMOVE:"REMOVE",IDENTIFIER_WILL_CHANGE:"IDENTIFIER_WILL_CHANGE",IDENTIFIER_DID_CHANGE:"IDENTIFIER_DID_CHANGE"},T="INITIAL",V="LOADING",N="LOADED",S="ERROR",R=e(function(t,e){var n;t.exports=(n=r,function(){if("function"==typeof ArrayBuffer){var t=n.lib.WordArray,e=t.init;(t.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var n=t.byteLength,r=[],o=0;o<n;o++)r[o>>>2]|=t[o]<<24-o%4*8;e.call(this,r,n)}else e.apply(this,arguments)}).prototype=t}}(),n.lib.WordArray)}),A=function(t,e){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return t.apply(e,n)}};function F(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}var I=Object.prototype.toString;function L(t){return"[object Array]"===I.call(t)}function M(t){return null!==t&&"object"===(void 0===t?"undefined":s(t))}function x(t){return"[object Function]"===I.call(t)}function U(t,e){if(null!==t&&void 0!==t)if("object"!==(void 0===t?"undefined":s(t))&&(t=[t]),L(t))for(var n=0,r=t.length;n<r;n++)e.call(null,t[n],n,t);else for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.call(null,t[o],o,t)}var D={isArray:L,isArrayBuffer:function(t){return"[object ArrayBuffer]"===I.call(t)},isBuffer:function(t){return null!=t&&(F(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&F(t.slice(0,0))}(t)||!!t._isBuffer)},isFormData:function(t){return"undefined"!=typeof FormData&&t instanceof FormData},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&t.buffer instanceof ArrayBuffer},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:M,isUndefined:function(t){return void 0===t},isDate:function(t){return"[object Date]"===I.call(t)},isFile:function(t){return"[object File]"===I.call(t)},isBlob:function(t){return"[object Blob]"===I.call(t)},isFunction:x,isStream:function(t){return M(t)&&x(t.pipe)},isURLSearchParams:function(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:U,merge:function t(){var e={};function n(n,r){"object"===s(e[r])&&"object"===(void 0===n?"undefined":s(n))?e[r]=t(e[r],n):e[r]=n}for(var r=0,o=arguments.length;r<o;r++)U(arguments[r],n);return e},extend:function(t,e,n){return U(e,function(e,r){t[r]=n&&"function"==typeof e?A(e,n):e}),t},trim:function(t){return t.replace(/^\s*/,"").replace(/\s*$/,"")}},B=function(t,e,n,r,o){return function(t,e,n,r,o){return t.config=e,n&&(t.code=n),t.request=r,t.response=o,t}(new Error(t),e,n,r,o)};function H(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var q=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],J=D.isStandardBrowserEnv()?function(){var t,e=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(t){var r=t;return e&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return t=r(window.location.href),function(e){var n=D.isString(e)?r(e):e;return n.protocol===t.protocol&&n.host===t.host}}():function(){return!0},W="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function z(){this.message="String contains an invalid character"}z.prototype=new Error,z.prototype.code=5,z.prototype.name="InvalidCharacterError";var G=function(t){for(var e,n,r=String(t),o="",i=0,s=W;r.charAt(0|i)||(s="=",i%1);o+=s.charAt(63&e>>8-i%1*8)){if((n=r.charCodeAt(i+=.75))>255)throw new z;e=e<<8|n}return o},X=D.isStandardBrowserEnv()?{write:function(t,e,n,r,o,i){var s=[];s.push(t+"="+encodeURIComponent(e)),D.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),D.isString(r)&&s.push("path="+r),D.isString(o)&&s.push("domain="+o),!0===i&&s.push("secure"),document.cookie=s.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},K="undefined"!=typeof window&&window.btoa&&window.btoa.bind(window)||G,Y=function(t){return new Promise(function(e,n){var r=t.data,o=t.headers;D.isFormData(r)&&delete o["Content-Type"];var i=new XMLHttpRequest,s="onreadystatechange",a=!1;if("undefined"==typeof window||!window.XDomainRequest||"withCredentials"in i||J(t.url)||(i=new window.XDomainRequest,s="onload",a=!0,i.onprogress=function(){},i.ontimeout=function(){}),t.auth){var u=t.auth.username||"",l=t.auth.password||"";o.Authorization="Basic "+K(u+":"+l)}if(i.open(t.method.toUpperCase(),function(t,e,n){if(!e)return t;var r;if(n)r=n(e);else if(D.isURLSearchParams(e))r=e.toString();else{var o=[];D.forEach(e,function(t,e){null!==t&&void 0!==t&&(D.isArray(t)?e+="[]":t=[t],D.forEach(t,function(t){D.isDate(t)?t=t.toISOString():D.isObject(t)&&(t=JSON.stringify(t)),o.push(H(e)+"="+H(t))}))}),r=o.join("&")}return r&&(t+=(-1===t.indexOf("?")?"?":"&")+r),t}(t.url,t.params,t.paramsSerializer),!0),i.timeout=t.timeout,i[s]=function(){if(i&&(4===i.readyState||a)&&(0!==i.status||i.responseURL&&0===i.responseURL.indexOf("file:"))){var r,o,s,u,l,c="getAllResponseHeaders"in i?(r=i.getAllResponseHeaders(),l={},r?(D.forEach(r.split("\n"),function(t){if(u=t.indexOf(":"),o=D.trim(t.substr(0,u)).toLowerCase(),s=D.trim(t.substr(u+1)),o){if(l[o]&&q.indexOf(o)>=0)return;l[o]="set-cookie"===o?(l[o]?l[o]:[]).concat([s]):l[o]?l[o]+", "+s:s}}),l):l):null,h={data:t.responseType&&"text"!==t.responseType?i.response:i.responseText,status:1223===i.status?204:i.status,statusText:1223===i.status?"No Content":i.statusText,headers:c,config:t,request:i};!function(t,e,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?e(B("Request failed with status code "+n.status,n.config,null,n.request,n)):t(n)}(e,n,h),i=null}},i.onerror=function(){n(B("Network Error",t,null,i)),i=null},i.ontimeout=function(){n(B("timeout of "+t.timeout+"ms exceeded",t,"ECONNABORTED",i)),i=null},D.isStandardBrowserEnv()){var c=X,h=(t.withCredentials||J(t.url))&&t.xsrfCookieName?c.read(t.xsrfCookieName):void 0;h&&(o[t.xsrfHeaderName]=h)}if("setRequestHeader"in i&&D.forEach(o,function(t,e){void 0===r&&"content-type"===e.toLowerCase()?delete o[e]:i.setRequestHeader(e,t)}),t.withCredentials&&(i.withCredentials=!0),t.responseType)try{i.responseType=t.responseType}catch(e){if("json"!==t.responseType)throw e}"function"==typeof t.onDownloadProgress&&i.addEventListener("progress",t.onDownloadProgress),"function"==typeof t.onUploadProgress&&i.upload&&i.upload.addEventListener("progress",t.onUploadProgress),t.cancelToken&&t.cancelToken.promise.then(function(t){i&&(i.abort(),n(t),i=null)}),void 0===r&&(r=null),i.send(r)})},$={"Content-Type":"application/x-www-form-urlencoded"};function Q(t,e){!D.isUndefined(t)&&D.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var Z,tt={adapter:("undefined"!=typeof XMLHttpRequest?Z=Y:"undefined"!=typeof process&&(Z=Y),Z),transformRequest:[function(t,e){return function(t,e){D.forEach(t,function(n,r){r!==e&&r.toUpperCase()===e.toUpperCase()&&(t[e]=n,delete t[r])})}(e,"Content-Type"),D.isFormData(t)||D.isArrayBuffer(t)||D.isBuffer(t)||D.isStream(t)||D.isFile(t)||D.isBlob(t)?t:D.isArrayBufferView(t)?t.buffer:D.isURLSearchParams(t)?(Q(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):D.isObject(t)?(Q(e,"application/json;charset=utf-8"),JSON.stringify(t)):t}],transformResponse:[function(t){if("string"==typeof t)try{t=JSON.parse(t)}catch(t){}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(t){return t>=200&&t<300}};tt.headers={common:{Accept:"application/json, text/plain, */*"}},D.forEach(["delete","get","head"],function(t){tt.headers[t]={}}),D.forEach(["post","put","patch"],function(t){tt.headers[t]=D.merge($)});var et=tt;function nt(){this.handlers=[]}nt.prototype.use=function(t,e){return this.handlers.push({fulfilled:t,rejected:e}),this.handlers.length-1},nt.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},nt.prototype.forEach=function(t){D.forEach(this.handlers,function(e){null!==e&&t(e)})};var rt=nt,ot=function(t,e,n){return D.forEach(n,function(n){t=n(t,e)}),t},it=function(t){return!(!t||!t.__CANCEL__)};function st(t){t.cancelToken&&t.cancelToken.throwIfRequested()}var at=function(t){var e,n,r;return st(t),t.baseURL&&(r=t.url,!/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(r))&&(t.url=(e=t.baseURL,(n=t.url)?e.replace(/\/+$/,"")+"/"+n.replace(/^\/+/,""):e)),t.headers=t.headers||{},t.data=ot(t.data,t.headers,t.transformRequest),t.headers=D.merge(t.headers.common||{},t.headers[t.method]||{},t.headers||{}),D.forEach(["delete","get","head","post","put","patch","common"],function(e){delete t.headers[e]}),(t.adapter||et.adapter)(t).then(function(e){return st(t),e.data=ot(e.data,e.headers,t.transformResponse),e},function(e){return it(e)||(st(t),e&&e.response&&(e.response.data=ot(e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)})};function ut(t){this.defaults=t,this.interceptors={request:new rt,response:new rt}}ut.prototype.request=function(t){"string"==typeof t&&(t=D.merge({url:arguments[0]},arguments[1])),(t=D.merge(et,{method:"get"},this.defaults,t)).method=t.method.toLowerCase();var e=[at,void 0],n=Promise.resolve(t);for(this.interceptors.request.forEach(function(t){e.unshift(t.fulfilled,t.rejected)}),this.interceptors.response.forEach(function(t){e.push(t.fulfilled,t.rejected)});e.length;)n=n.then(e.shift(),e.shift());return n},D.forEach(["delete","get","head","options"],function(t){ut.prototype[t]=function(e,n){return this.request(D.merge(n||{},{method:t,url:e}))}}),D.forEach(["post","put","patch"],function(t){ut.prototype[t]=function(e,n,r){return this.request(D.merge(r||{},{method:t,url:e,data:n}))}});var lt=ut;function ct(t){this.message=t}ct.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},ct.prototype.__CANCEL__=!0;var ht=ct;function pt(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var e;this.promise=new Promise(function(t){e=t});var n=this;t(function(t){n.reason||(n.reason=new ht(t),e(n.reason))})}pt.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},pt.source=function(){var t;return{token:new pt(function(e){t=e}),cancel:t}};var ft=pt;function _t(t){var e=new lt(t),n=A(lt.prototype.request,e);return D.extend(n,lt.prototype,e),D.extend(n,e),n}var yt=_t(et);yt.Axios=lt,yt.create=function(t){return _t(D.merge(et,t))},yt.Cancel=ht,yt.CancelToken=ft,yt.isCancel=it,yt.all=function(t){return Promise.all(t)},yt.spread=function(t){return function(e){return t.apply(null,e)}};var dt=yt,gt=yt;dt.default=gt;var vt,mt=dt,wt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;a(this,t),this.x=e,this.y=n,this.z=r}return u(t,null,[{key:"fromJSON",value:function(e){var n=new t;return n.set(e),n}}]),u(t,[{key:"set",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"toJSON",value:function(){return{x:this.x,y:this.y,z:this.z}}}]),t}(),bt="Must be valid",Ot="Must be a Symbol",kt=function(){function t(){if(a(this,t),this.constructor===t)throw new TypeError("AbstractValidator is abstract");if(void 0===this.isValid)throw new TypeError("#isValid is abstract")}return u(t,null,[{key:"message",get:function(){return bt}}]),t}(),Pt=function(t){function e(t){a(this,e);var n=p(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.validators=t,n}return h(e,kt),u(e,[{key:"isValid",value:function(t,e,n){for(var r=0;r<this.validators.length;r++){if(this.validators[r].isValid(t,e,n))return!0}return!1}}]),e}(),Et=function(t){function e(t){a(this,e);var n=p(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.validators=t,n}return h(e,kt),u(e,[{key:"isValid",value:function(t,e,n){for(var r=0;r<this.validators.length;r++){if(!this.validators[r].isValid(t,e,n))return!1}return!0}}]),e}(),Ct=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,kt),u(e,[{key:"isValid",value:function(t,e,n){return null===e[n]}}]),e}(),jt=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,kt),u(e,[{key:"isValid",value:function(t,e,n){return"symbol"===s(e[n])}}],[{key:"message",get:function(){return Ot}}]),e}(),Tt=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,kt),u(e,[{key:"isValid",value:function(t,e,n){return Number.isInteger(e[n])}}]),e}(),Vt=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,kt),u(e,[{key:"isValid",value:function(t,e,n){return Number.isFinite(e[n])&&e[n]<0}}]),e}(),Nt=function(t){function e(t){a(this,e);var n=p(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.validator=t,n}return h(e,kt),u(e,[{key:"isValid",value:function(t,e,n){return!this.validator.isValid(t,e,n)}}]),e}(),St=function(){function t(){a(this,t)}return u(t,null,[{key:"toJSON",value:function(t){for(var e=Array.from(t.values()),n=0;n<e.length;n++)"object"===s(e[n])&&null!==e[n]&&"function"==typeof e[n].toJSON&&(e[n]=e[n].toJSON());return e}},{key:"set",value:function(t,e){t.clear(),e.forEach(function(e){t.add(e)})}}]),t}(),Rt=function(){function t(){a(this,t)}return u(t,null,[{key:"toJSON",value:function(t){var e=Object.create(null);return t.forEach(function(t,n){e[n]=t}),e}},{key:"set",value:function(t,e){t.clear(),"object"===(void 0===e?"undefined":s(e))?Object.keys(e).forEach(function(n){t.set(n,e[n])}):e.forEach(function(e){var n=f(e,2),r=n[0],o=n[1];t.set(r,o)})}}]),t}(),At=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;a(this,t),this.classOf=e,this.value=null,this.set(n)}return u(t,null,[{key:"cast",value:function(e,n){if(null===n||"symbol"===(void 0===n?"undefined":s(n))||Number.isInteger(n))return n;if("object"!==(void 0===n?"undefined":s(n)))throw new TypeError("Expected integer, null, "+e+" or Reference<"+e+"> but got "+(void 0===n?"undefined":s(n)));if(n instanceof t){if(n.classOf!==e)throw new TypeError("Expected reference of "+e+" but got reference of "+n.classOf);return n.value}var r=null;switch(n.constructor.getName()){case"Label":case"Picto":r="CustomObject";break;case"Kiosk":case"Mobile":case"Web":r="Device";break;case"MapAoDae":case"MapConfig":case"MapDae":case"MapHelper":case"MapLight":case"MapPath":r="MapFile";break;case"MediaImage":case"MediaPdf":case"MediaText":case"MediaUrl":case"MediaVideo":case"Movie":r="Media";break;case"Exhibitor":case"Person":case"Product":case"Room":case"Service":case"Store":r="Poi";break;default:r=n.constructor.name}if(!n._isEntity)throw new TypeError("Expected integer, null or "+e+" or Reference<"+e+">");if(r!==e)throw new TypeError("Expected integer, null or "+e+" or Reference<"+e+"> but got "+n.constructor.getName());return n.id}}]),u(t,[{key:"set",value:function(t){return this.value=this.constructor.cast(this.classOf,t),this}},{key:"toJSON",value:function(){return this.value}},{key:"is",value:function(t){return this.constructor.cast(this.classOf,t)===this.value}}]),t}(),Ft=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;a(this,t),this.classOf=e,this.values=new Set,n&&this.set(n)}return u(t,[{key:Symbol.iterator,value:function(){return this.values[Symbol.iterator]()}},{key:"forEach",value:function(t){return this.values.forEach(t),this}},{key:"set",value:function(t){var e=this;return this.clear(),t.forEach(function(t){e.add(t)}),this}},{key:"at",value:function(t){var e=0,n=null;return this.values.forEach(function(r){e===t&&(n=r),e++}),n}},{key:"add",value:function(t){return this.has(t)?this:(this.values.add(new At(this.classOf,t)),this)}},{key:"remove",value:function(t){var e=this;return this.forEach(function(n){n.is(t)&&e.values.delete(n)}),this}},{key:"has",value:function(t){var e=!1;return this.forEach(function(n){!e&&n.is(t)&&(e=!0)}),e}},{key:"indexOf",value:function(t){var e=-1,n=0;return this.forEach(function(r){-1===e&&r.is(t)&&(e=n),n++}),e}},{key:"clear",value:function(){return this.values.clear()}},{key:"toJSON",value:function(){var t=[];return this.forEach(function(e){t.push(e.toJSON())}),t}},{key:"size",get:function(){return this.values.size}}]),t}(),It=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;a(this,t),this.classOf=e,this.values=[],n&&this.set(n)}return u(t,null,[{key:"castPosition",value:function(t,e){var n=t;if(null===t||void 0===t)return null;if("string"==typeof t&&(n=Number.isNaN(Number(t))?t:parseInt(t,10)),!Number.isInteger(n))throw new TypeError("Position has to be an integer.");return n>=e?null:n}},{key:"order",value:function(t){var e=-1;return t.map(function(t){if(e++,null===t)throw new TypeError("OrderedCollection should not have null value");return"object"!==(void 0===t?"undefined":s(t))?{id:t,position:e}:t instanceof At||t._isEntity?{id:t,position:e}:t}).sort(function(e,n){return n.position!==e.position?n.position-e.position:"symbol"===s(e.id)&&"symbol"===s(n.id)?t.indexOf(e)-t.indexOf(n):"symbol"===s(e.id)?1:"symbol"===s(n.id)?-1:e.id-n.id}).map(function(t){return t.id})}}]),u(t,[{key:Symbol.iterator,value:function(){return this.values[Symbol.iterator]()}},{key:"forEach",value:function(t){this.values.forEach(function(e){t(e)})}},{key:"set",value:function(t){var e=this;return this.clear(),this.constructor.order(t).forEach(function(t){e.values.push(new At(e.classOf,t))}),this}},{key:"add",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.constructor.castPosition(e,this.size),r=this.indexOf(t);return-1!==r&&this.removeAt(r),null===n?this.values.push(new At(this.classOf,t)):this.values.splice(n,0,new At(this.classOf,t)),this}},{key:"remove",value:function(t){var e=this.indexOf(t);return e>-1&&this.removeAt(e),this}},{key:"removeAt",value:function(t){return this.values.splice(t,1),this}},{key:"has",value:function(t){var e=!1;return this.forEach(function(n){!e&&n.is(t)&&(e=!0)}),e}},{key:"indexOf",value:function(t){var e=-1,n=0;return this.forEach(function(r){-1===e&&r.is(t)&&(e=n),n++}),e}},{key:"at",value:function(t){var e=0,n=null;return this.values.forEach(function(r){e===t&&(n=r),e++}),n}},{key:"clear",value:function(){return this.values.length=0,this}},{key:"toJSON",value:function(){var t=this.size;return this.values.map(function(e){return{id:e.toJSON(),position:--t}})}},{key:"size",get:function(){return this.values.length}}]),t}(),Lt=new Map,Mt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;a(this,t),this.constructor._isAbstract()&&this._throwIsAbstract(),this._isEntity=!0,this._reset(),null!==e&&this.fromJSON(e)}return u(t,[{key:"set",value:function(t,e){return this[t]instanceof Set?St.set(this[t],e):this[t]instanceof Map?Rt.set(this[t],e):this[t]instanceof At||this[t]instanceof Ft||this[t]instanceof It||this[t]instanceof wt?this[t].set(e):this[t]=e,this}}],[{key:"getName",value:function(){return"AbstractEntity"}},{key:"create",value:function(){return new this(arguments.length>0&&void 0!==arguments[0]?arguments[0]:null)}},{key:"keys",get:function(){var t=[];return t.push("id"),t}}]),u(t,[{key:"toJSON",value:function(){var t=this,e={};return this.constructor.keys.forEach(function(n){t[n]instanceof Date||t[n]instanceof At||t[n]instanceof Ft||t[n]instanceof It||t[n]instanceof wt?e[n]=t[n].toJSON():t[n]instanceof Set?e[n]=St.toJSON(t[n]):t[n]instanceof Map?e[n]=Rt.toJSON(t[n]):e[n]=t[n]}),e}},{key:"fromJSON",value:function(t){var e=this;return this.constructor.keys.forEach(function(n){t.hasOwnProperty(n)&&e.set(n,t[n])}),this}},{key:"clone",value:function(){return this.constructor.create(this.constructor._deepClone(this.toJSON()))}},{key:"_reset",value:function(){this.id=null}},{key:"_throwIsAbstract",value:function(){throw new TypeError(this.constructor.getName()+" is abstract")}}],[{key:"_deepClone",value:function(t){if(null===t||"object"!==(void 0===t?"undefined":s(t)))return t;if(Array.isArray(t)){for(var e=[],n=0;n<t.length;n++)e.push(this._deepClone(t[n]));return e}for(var r={},o=Object.keys(t),i=0;i<o.length;i++){var a=o[i];r[a]=this._deepClone(t[a])}return r}},{key:"_setPropertyValidator",value:function(t,e){Lt.get(this.getName()).set(t,e)}},{key:"_isAbstract",value:function(){return!0}},{key:"_buildValidators",value:function(){Lt.set(this.getName(),new Map),this._setPropertyValidator("id",new Pt([new Ct,new jt,new Et([new Tt,new Nt(new Vt)])]))}},{key:"_validators",get:function(){return Lt.has(this.getName())||this._buildValidators(),Lt.get(this.getName())}}]),t}(),xt=function(t){return function(e){function n(){return a(this,n),p(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return h(n,t),u(n,[{key:"_reset",value:function(){c(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"_reset",this).call(this),this.site=new At("Site",null)}}],[{key:"keys",get:function(){var t=c(n.__proto__||Object.getPrototypeOf(n),"keys",this);return t.push("site"),t}}]),n}()},Ut=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,kt),u(e,[{key:"isValid",value:function(t,e,n){return"string"==typeof e[n]&&e[n].length>0&&e[n].length<=255}}]),e}(),Dt=function(t){return function(e){function n(){return a(this,n),p(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return h(n,t),u(n,[{key:"_reset",value:function(){c(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"_reset",this).call(this),this.name=null}}],[{key:"_buildValidators",value:function(){c(n.__proto__||Object.getPrototypeOf(n),"_buildValidators",this).call(this),this._setPropertyValidator("name",new Ut)}},{key:"keys",get:function(){var t=c(n.__proto__||Object.getPrototypeOf(n),"keys",this);return t.push("name"),t}}]),n}()},Bt=function(t){return function(e){function n(){return a(this,n),p(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return h(n,t),u(n,[{key:"_reset",value:function(){c(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"_reset",this).call(this),this.metadata=new Map}}],[{key:"keys",get:function(){var t=c(n.__proto__||Object.getPrototypeOf(n),"keys",this);return t.push("metadata"),t}}]),n}()},Ht=function(t){function e(t){a(this,e);var n=p(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.enum=t,n.enumKeys=Object.keys(n.enum),n.enumValues=[],n.enumKeys.forEach(function(t){n.enumValues.push(n.enum[t])}),n}return h(e,kt),u(e,[{key:"isValid",value:function(t,e,n){return this.enumValues.includes(e[n])}}]),e}(),qt={DEFAULT:"default",TEXTURE:"texture",TEXTURE_MODEL:"texture_model",MEDIA:"media",MEDIA_FILE:"media_file",MEDIA_PREVIEW:"media_preview",MAP:"map",PICTO:"picto",CATEGORY:"category",SITE:"site",POI:"poi",TEXTURE_LOW:"texture_low",TEXTURE_OCCLUSION:"texture_occlusion",TEXTURE_HELPER:"texture_helper"},Jt=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,t),u(e,[{key:"fromBlob",value:function(t){throw new Error("File#fromBlob is available in Browser environment")}},{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.reference=null,this.content_hash=null,this.file_type=null,this.uri=null,this.context=qt.DEFAULT}}],[{key:"getName",value:function(){return"File"}},{key:"_isAbstract",value:function(){return!1}},{key:"fromFileEntity",value:function(t){if(!(t instanceof this))throw new TypeError("Expected an instance of File");var e=new this;return e.name=t.name,e.uri=t.uri,e.file_type=t.file_type,e.content_hash=t.content_hash,e.site=t.site,e}},{key:"fromBlob",value:function(t){var e=new this;return e.fromBlob(t),e}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("uri",new Ut),this._setPropertyValidator("context",new Ht(qt))}},{key:"_getBlobFromUri",value:function(t){throw new Error("File#_getBlobFromUri is available in Browser environment")}},{key:"_addBlobUri",value:function(t,e){throw new Error("File#_addBlobUri is available in Browser environment")}},{key:"_getBufferFromUri",value:function(t){throw new Error("File#_getBufferFromUri is available in Node environment")}},{key:"_addBufferUri",value:function(t,e){throw new Error("File#_addBufferUri is available in Node environment")}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("reference"),t.push("context"),t.push("file_type"),t.push("content_hash"),t.push("uri"),t}}]),e}(Dt(xt(Bt(Mt)))),Wt=new Map,zt=new Map,Gt=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Jt),u(e,[{key:"fromBlob",value:function(t){if(!(t instanceof Blob))throw new TypeError("Expected an instance of Blob");this.name="blob",this.file_type=t.type,this.uri=Wt.has(t)?Wt.get(t):URL.createObjectURL(t),zt.set(this.uri,t),Wt.set(t,this.uri),t instanceof window.File&&(this.name=t.name)}}],[{key:"_getBlobFromUri",value:function(t){return null===t?null:zt.has(t)?zt.get(t):null}},{key:"_addBlobUri",value:function(t,e){zt.set(t,e)}}]),e}(),Xt=new WeakMap,Kt=mt.create({timeout:0,maxContentLength:-1}),Yt=function(){function t(){a(this,t),this.parameters={},this.headers={},this.method="GET",this.url=null,this.data=null,this.responseType="json"}return u(t,null,[{key:"sendRequest",value:function(t){if(!(t instanceof this))throw new Error("Request instance expected");return Kt.request({headers:t.headers,method:t.method,url:t.url,params:t.parameters,data:t.data,responseType:t.responseType}).then(function(e){return"document"===t.responseType&&(e.responseXML=e.data),e})}},{key:"getUriContentHash",value:function(t){var e=this;return this._getBufferFromUri(t).then(function(t){return e.getBufferContentHash(t)})}},{key:"getBufferContentHash",value:function(t){throw new Error("This is abstract")}},{key:"_getBufferFromUri",value:function(t){var e=Gt._getBufferFromUri(t);if(null!==e)return Promise.resolve(e);var n=new this;return n.method="get",n.responseType="arraybuffer",n.url=t,this.sendRequest(n).then(function(n){return e=n.data,Gt._addBufferUri(t,e),e})}},{key:"formatRequestContext",value:function(t){return{request:{headers:t.headers,method:t.method,url:t.url,params:t.parameters,data:t.data,responseType:t.responseType}}}},{key:"formatApiError",value:function(t,e){var n=this.formatRequestContext(e),r=null,o=null;if(t.response){var i=t.response,s=i.status,a=i.data,u=i.headers;s>=400&&s<500?(r=403===s?"Authentication failed; check your credentials, clock and authorizations":"Request failed due to invalid request",o={response:{data:a,headers:u},request:n}):503===s?(r="Server is busy",o={response:{data:a,headers:u},request:n}):(r="Server error",o={response:{data:a,headers:u},request:n})}else t.request?(r="No response from Server",o={request:n}):(r="No response from Server",o=t);return{message:r,context:o}}}]),u(t,[{key:"addParameter",value:function(t,e){return this.parameters[t]=e,this}},{key:"addParameters",value:function(t){for(var e=Object.keys(t),n=0;n<e.length;n++){var r=e[n];this.addParameter(r,t[r])}return this}},{key:"formattedParameters",value:function(){for(var t=[],e=Object.keys(this.parameters),n=0;n<e.length;n++){var r=e[n],o=this.parameters[r];t.push(r+"="+o)}return t.join("&")}},{key:"addHeader",value:function(t,e){return this.headers[t]=e,this}},{key:"addHeaders",value:function(t){for(var e=Object.keys(t),n=0;n<e.length;n++){var r=e[n];this.addHeader(r,t[r])}return this}},{key:"formattedUrl",value:function(){return this.url+"?"+this.formattedParameters()}},{key:"url",get:function(){return Xt.get(this)},set:function(t){var e=t;if(null!==t&&-1!==t.indexOf("?")){var n=t.split("?"),r=n.splice(0,1);e=f(r,1)[0];for(var o=n.join("?").split("&"),i=0;i<o.length;i++){var s=o[i].split("="),a=s.splice(0,1)[0],u=s.join("=");this.addParameter(a,u)}}return Xt.set(this,e),this}}]),t}(),$t=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Yt),u(e,null,[{key:"getBufferContentHash",value:function(t){return i(R.create(t,t.length)).toString()}},{key:"formatRequestContext",value:function(t){var n=c(e.__proto__||Object.getPrototypeOf(e),"formatRequestContext",this).call(this,t);if(n.data instanceof FormData){var r={};n.data.entries().forEach(function(t){var e=f(t,2),n=e[0],o=e[1];r[n]=o instanceof Blob?"Blob":o}),n.data=r}return n}}]),e}(),Qt=function(){function t(){a(this,t),this._idToEntityMap=new Map,this._entityList=null}return u(t,[{key:Symbol.iterator,value:function(){return this.getAll()[Symbol.iterator]()}},{key:"store",value:function(t){return this._idToEntityMap.set(t.id,t),this._entityList=null,t}},{key:"remove",value:function(t){this.has(t.id)&&(this._idToEntityMap.delete(t.id),this._entityList=null)}},{key:"getAll",value:function(){var t=this;return null===this._entityList&&(this._entityList=[],this._idToEntityMap.forEach(function(e){t._entityList.push(e)})),this._entityList}},{key:"get",value:function(t){return this.has(t)?this._idToEntityMap.get(t):null}},{key:"has",value:function(t){return this._idToEntityMap.has(t)}},{key:"clone",value:function(){var e=new t;return this.getAll().forEach(function(t){e._idToEntityMap.set(t.id,t.clone())}),e}}]),t}(),Zt=function(){function t(e){a(this,t),this._expectedClassOf=this.constructor.getEntityClass().getName(),this._logger=new v(e.options.logger,this._expectedClassOf),this._init(e)}return u(t,[{key:"isLoaded",value:function(){return this._status===N}},{key:"isLoading",value:function(){return this._status===V}},{key:"load",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.isLoading()||this.isLoaded())return this.isLoading()?this._task:Promise.resolve();this._logger.info("loading start"),this._status=V;var n=this._loadIntoNewStorage(e).then(function(e){t._logger.debug("loading storing data"),t._storage=e,t._status=N,t._logger.info("loading success")}).catch(function(e){return t._logger.error("loading fail",{error:e}),t._status=S,Promise.reject(e)});return this._task=n,n}},{key:"loadFromCache",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isLoading()||this.isLoaded())return this.isLoading()?this._task:Promise.resolve();this._logger.info("loading start"),this._status=V;var n=this._loadFromCacheIntoNewStorage(e).then(function(e){t._logger.debug("loading storing data"),t._storage=e,t._status=N,t._logger.info("loading success")}).catch(function(e){return t._logger.error("loading fail",{error:e}),t._status=S,Promise.reject(e)});return this._task=n,n}},{key:"getAll",value:function(){return this._assertIsLoaded(),this._storage.getAll()}},{key:"get",value:function(t){switch(this._assertIsLoaded(),!0){case t instanceof At:if(t.classOf!==this._expectedClassOf)throw new TypeError("Expected a Reference<"+this._expectedClassOf+"> but got Reference<"+t.classOf+">");return this._storage.get(t.value);case"object"===(void 0===t?"undefined":s(t))&&null!==t:return this._storage.get(t.id);case"string"==typeof t:return this._storage.get(parseInt(t,10));default:return this._storage.get(t)}}},{key:"getList",value:function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.get(t))}),n}},{key:"findBy",value:function(t){if("object"!==(void 0===t?"undefined":s(t)))throw new Error("Filters need to be specified");var e=Object.keys(t);return this.getAll().filter(function(n){for(var r=0;r<e.length;r++){var o=e[r],i=t[o],a=!1;switch(void 0===i?"undefined":s(i)){case"function":a=i(n[o]);break;default:a=n[o]===i}if(!a)return!1}return!0})}},{key:"findOneBy",value:function(t){var e=this.findBy(t);if(e.length>1)throw new Error("Result isn't unique, please use #findBy method instead");return 0===e.length?null:e[0]}},{key:"persist",value:function(t){this._logger.info("persist entity",{entity:t}),this.em._assertIsNotLocked(),this._persist(t)}},{key:"remove",value:function(t){this._logger.info("remove entity",{id:t}),this.em._assertIsNotLocked(),this._remove(t)}},{key:"validate",value:function(t){return this._logger.info("validate entity",{entity:t}),this.constructor._throwExceptionIfNotSupported(t),this._assertIsLoaded(),this._validate(t)}},{key:"validateProperty",value:function(t,e){return this._logger.info("validate entity",{entity:t}),this.constructor._throwExceptionIfNotSupported(t),this._assertIsLoaded(),this._validateProperty(t,e)}},{key:"isValid",value:function(t){return 0===this.validate(t).size}},{key:"_init",value:function(t){this._logger.debug("initialisation"),this.em=t,this._eventDispatcher=C,this._storage=new Qt,this._status=T,this._task=null}},{key:"_loadFromCacheIntoNewStorage",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=this.em.options.cacheManager;return null===n?Promise.reject(new Error("AbstractRepository.loadFromCache: no CacheManager")):n.get(this.constructor.getName(),this.em.options,e).then(function(e){return t._putResultIntoNewStorage(e)})}},{key:"_validateProperty",value:function(t,e){var n=t.constructor._validators;if(!n.has(e))return null;var r=n.get(e);return r.isValid(this.em,t,e)?null:r.constructor.message}},{key:"_getLoadRequest",value:function(t){var e=new $t;return e.url=this.em.options.getEndpoint()+"/"+this.constructor._endpoint,e.parameters.start=t||0,e}},{key:"_getCreateRequest",value:function(t){var e=new $t,n=t.toJSON();return delete n.id,this.constructor._readOnlyKeys.forEach(function(t){delete n[t]}),e.method="POST",e.url=this.em.options.getEndpoint()+"/"+this.constructor._endpoint,e.data=JSON.stringify(n),e.addHeader("Content-Type","application/json"),e}},{key:"_getUpdateRequest",value:function(t,e){var n=new $t,r=t.toJSON(),o=this.constructor._readOnlyKeys;return Object.keys(r).forEach(function(t){-1!==e.indexOf(t)&&-1===o.indexOf(t)||delete r[t]}),n.method="POST",n.url=this.em.options.getEndpoint()+"/"+this.constructor._endpoint+"/"+t.id,n.data=JSON.stringify(r),n.addHeader("Content-Type","application/json"),n}},{key:"_getRemoveRequest",value:function(t){var e=new $t;e.method="DELETE",e.url=this.em.options.getEndpoint()+"/"+this.constructor._endpoint;var n=t.map(function(t){return t.id}).join(",");return e.addParameter("id",n),e}},{key:"_assertIsLoaded",value:function(){if(!this.isLoaded())throw this._logger.error("is not loaded"),new Error("The repository "+this.constructor.getName()+" must be loaded but it's in "+this._status+" state for now !")}},{key:"_loadIntoNewStorage",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._logger.verbose("loading first page"),this._loadFromCacheIntoNewStorage(!1).catch(function(){return t._loadFromApiIntoNewStorage()}).catch(function(n){return e?(t._logger.error("loading failed, fallback to outdated cache",{error:n}),t._loadFromCacheIntoNewStorage(!0).catch(function(){return Promise.reject(n)})):Promise.reject(n)})}},{key:"_loadFromApiIntoNewStorage",value:function(){var t=this;return this.em._xhr(this._getLoadRequest(),200).then(function(e){t._logger.verbose("loading first page success");var n=[],r=e.headers["content-range"];if(!r)throw new Error("Content-Range is not present");var o=r.match(/^(-?[0-9]+)-(-?[0-9]+)\/([0-9]+)$/);if(!o)throw new Error("Content-Range invalid");var i=parseInt(o[1],10),s=parseInt(o[2],10),a=parseInt(o[3],10),u=s-i;for(n.push(Promise.resolve(e));s+1<a;)t._logger.verbose("loading next page"),s=(i=s+1)+u,n.push(t.em._xhr(t._getLoadRequest(i),200));return Promise.all(n).then(function(e){t._logger.verbose("loading all pages success");for(var n=[],r=0;r<e.length;r++){var o=e[r].data;if(!Array.isArray(o)){var i="Return format expected to be an array while loading "+t.constructor.getName();throw new Error(i)}n=n.concat(o)}if(n.length!==a)throw new Error('"Expected '+a+" results for but got "+n.length);return n})}).then(function(e){return t._putResultIntoNewStorage(e)})}},{key:"_putResultIntoNewStorage",value:function(t){for(var e=new Qt,n=0;n<t.length;n++){var r=this.constructor.fromJSON(t[n]);null!==r&&e.store(r)}return e}},{key:"_replaceStorage",value:function(t){var e,n=this,r=this._storage;this._storage=t;var o=(l(e={},j.CREATE,[]),l(e,j.UPDATE,[]),l(e,j.REMOVE,[]),e);return r.getAll().forEach(function(t){null===n.get(t.id)&&o[j.REMOVE].push(t)}),this.getAll().forEach(function(t){if(r.has(t.id)){var e=r.get(t.id),i=n.constructor._compare(e,t);0!==i.length&&(o[j.UPDATE]={current:t,previous:e,changes:i})}else o[j.CREATE]=t}),o}},{key:"_persist",value:function(t,e){this._logger.debug("persist",{entity:t,internal:e}),this._assertIsLoaded(),this.constructor._throwExceptionIfNotSupported(t),this._assertIsValid(t),null===t.id?this._create(t,e):this._update(t,e)}},{key:"_remove",value:function(t,e){this._logger.debug("remove",{id:t,internal:e}),this._assertIsLoaded();var n=this.get(t);if(null!==n&&(this._storage.remove(n),this._eventDispatcher.publish(this,j.REMOVE,n),!e)){var r=[this,j.REMOVE,[n.clone()]];this._logger.debug("commit",{commit:r}),this.em._uow.commits.add(r)}}},{key:"_validate",value:function(t){var e=this,n=t.constructor._validators,r=new Map;return n.forEach(function(n){var o=f(n,2),i=o[0],s=o[1];s.isValid(e.em,t,i)||r.set(i,s.constructor.message)}),r}},{key:"_assertIsValid",value:function(t){if(!this.isValid(t)){var e="Given "+t.constructor.getName()+" is not valid";throw this.validate(t).forEach(function(t){var n=f(t,2),r=n[0],o=n[1];e+="\n\t"+r+": "+o}),new TypeError(e)}}},{key:"_create",value:function(t,e){if(null===t.id&&(t.id=Symbol("AdsumClientApi_entity_id")),this._overrideSiteEntity(t),this._storage.store(t),this._logger.debug("create",{entity:t,internal:e}),this._eventDispatcher.publish(this,j.CREATE,t),!e){var n=[this,j.CREATE,t.clone()];this._logger.debug("commit",{commit:n}),this.em._uow.commits.add(n)}}},{key:"_update",value:function(t,e){var n=this.get(t.id);if(null===n)throw new TypeError("Provided entity has id set but is not found, are you sure the entity is not remove ?");if(n.constructor===t.constructor){var r=this.constructor._compare(n,t);if(0!==r.length&&(this._logger.debug("update",{entity:t,previous:n,changes:r,internal:e}),this._storage.store(t),this._eventDispatcher.publish(this,j.UPDATE,{current:t,previous:n,changes:r}),!e)){var o=[this,j.UPDATE,{current:t.clone(),previous:n,changes:r}];this._logger.debug("commit",{commit:o}),this.em._uow.commits.add(o)}}else this._switchType(t,n,e)}},{key:"_overrideSiteEntity",value:function(t){-1!==t.constructor.keys.indexOf("site")&&(t.site=this.em.options.site)}},{key:"_switchType",value:function(t,e,n){this._logger.debug("switch type",{entity:t,previous:e,internal:n}),t.id=null,this._create(t,n),this._remove(e,n)}}],[{key:"getName",value:function(){return this.getEntityClass().getName()}},{key:"getEntityClass",value:function(){throw new Error("You must implements #getEntityClass")}},{key:"fromJSON",value:function(t){return this.getEntityClass().create(t)}},{key:"_compare",value:function(t,e){var n=this;if(this._throwExceptionIfNotSupported(t),this._throwExceptionIfNotSupported(e),e.constructor!==t.constructor)throw new TypeError("Cannot compare two entity of different classes");var r=t.toJSON(),o=e.toJSON(),i=[];return Object.keys(r).forEach(function(t){var e=r[t],s=o[t];n._areDeepEqual(e,s)||i.push(t)}),i}},{key:"_areDeepEqual",value:function(t,e){if(t===e)return!0;if("object"!==(void 0===t?"undefined":s(t))||(void 0===t?"undefined":s(t))!==(void 0===e?"undefined":s(e)))return!1;if(null===t||null===e)return!1;if(t.constructor!==e.constructor)return!1;if(Array.isArray(t)){if(t.length!==e.length)return!1;for(var n=new Set,r=0;r<t.length;r++){for(var o=t[r],i=!1,a=0;a<e.length;a++)if(!n.has(a)&&this._areDeepEqual(o,e[a])){n.add(a),i=!0;break}if(!i)return!1}return!0}var u=Object.keys(t);if(!this._areDeepEqual(u,Object.keys(e)))return!1;for(var l=0;l<u.length;l++){var c=u[l];if(!this._areDeepEqual(t[c],e[c]))return!1}return!0}},{key:"_throwExceptionIfNotSupported",value:function(t){if(!(t instanceof this.getEntityClass()))throw new TypeError("Unsupported entity")}},{key:"_readOnlyKeys",get:function(){return[]}},{key:"_endpoint",get:function(){return this.getEntityClass().getName().toLowerCase()}}]),t}(),te=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,kt),u(e,[{key:"isValid",value:function(t,e,n){return this.constructor.isReference(t,e[n])}}],[{key:"isReference",value:function(t,e){if(!(e instanceof At))return!1;var n=t.getRepository(e.classOf);return null!==n&&(e.is(null)||null!==n.get(e))}}]),e}(),ee=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,te),u(e,[{key:"isValid",value:function(t,n,r){return c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"isValid",this).call(this,t,n,r)&&!n[r].is(null)}}]),e}(),ne=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,kt),u(e,[{key:"isValid",value:function(t,e,n){var r=e[n];return r instanceof wt&&(Number.isFinite(r.x)&&Number.isFinite(r.y)&&Number.isFinite(r.z))}}]),e}(),re=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,kt),u(e,[{key:"isValid",value:function(t,e,n){return Number.isFinite(e[n])}}]),e}(),oe=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,kt),u(e,[{key:"isValid",value:function(t,e,n){return"boolean"==typeof e[n]}}]),e}(),ie={BILLBOARD:"BILLBOARD",STATIC:"STATIC",FLIP:"FLIP"},se=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,t),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=null,this.place=new At("Place",null),this.poi=new At("Poi",null),this.offset=new wt,this.autoscale=!1,this.rotation=0,this.priority=0,this.orientation_mode=ie.BILLBOARD,this.permanent_display=!0}}],[{key:"getName",value:function(){return"CustomObject"}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("place",new ee),this._setPropertyValidator("poi",new te),this._setPropertyValidator("offset",new ne),this._setPropertyValidator("autoscale",new oe),this._setPropertyValidator("rotation",new re),this._setPropertyValidator("priority",new Tt),this._setPropertyValidator("orientation_mode",new Ht(ie)),this._setPropertyValidator("permanent_display",new oe)}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("type"),t.push("place"),t.push("poi"),t.push("offset"),t.push("autoscale"),t.push("rotation"),t.push("priority"),t.push("orientation_mode"),t.push("permanent_display"),t}}]),e}(xt(Bt(Mt))),ae={PICTO:"picto",LABEL:"label"},ue={LEFT:"left",RIGHT:"right",CENTER:"center"},le=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,kt),u(e,[{key:"isValid",value:function(t,e,n){return Number.isFinite(e[n])&&e[n]>0}}]),e}(),ce=function(t){function e(t){a(this,e);var n=p(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.constant=t,n}return h(e,kt),u(e,[{key:"isValid",value:function(t,e,n){return e[n]===this.constant}}]),e}(),he=function(t){function e(t){a(this,e);var n=p(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.regex=t,n}return h(e,kt),u(e,[{key:"isValid",value:function(t,e,n){return"string"==typeof e[n]&&null!==e[n].match(this.regex)}}]),e}(),pe=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,se),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=ae.LABEL,this.alignment=ue.CENTER,this.font="Arial",this.font_size=5,this.font_color="#000000",this.background_color=null,this.label=null}}],[{key:"getName",value:function(){return"Label"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("type",new ce(ae.LABEL)),this._setPropertyValidator("font",new Pt([new Ct,new Ut])),this._setPropertyValidator("alignment",new Ht(ue)),this._setPropertyValidator("font_size",new Et([new Tt,new le])),this._setPropertyValidator("background_color",new Pt([new Ct,new he(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/)])),this._setPropertyValidator("font_color",new he(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/)),this._setPropertyValidator("label",new Ut)}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("font"),t.push("alignment"),t.push("font_size"),t.push("font_color"),t.push("background_color"),t.push("label"),t}}]),e}(),fe=function(t){return function(e){function n(){return a(this,n),p(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return h(n,t),u(n,[{key:"_reset",value:function(){c(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"_reset",this).call(this),this.file=new At("File",null)}}],[{key:"_buildValidators",value:function(){c(n.__proto__||Object.getPrototypeOf(n),"_buildValidators",this).call(this),this._setPropertyValidator("file",new ee)}},{key:"keys",get:function(){var t=c(n.__proto__||Object.getPrototypeOf(n),"keys",this);return t.push("file"),t}}]),n}()},_e=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,t),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=ae.PICTO,this.width=null,this.height=null,this.original_md5=null}}],[{key:"getName",value:function(){return"Picto"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("type",new ce(ae.PICTO)),this._setPropertyValidator("width",new le),this._setPropertyValidator("height",new le),this._setPropertyValidator("original_md5",new Pt([new Ct,new Ut]))}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("width"),t.push("height"),t.push("original_md5"),t}}]),e}(fe(se)),ye=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Zt),u(e,null,[{key:"getEntityClass",value:function(){return se}},{key:"fromJSON",value:function(t){if("object"!==(void 0===t?"undefined":s(t))||null===t)throw new TypeError("Expected an object");switch(t.type){case"label":return new pe(t);case"picto":return new _e(t);default:throw new Error("Unable to parse CustomObject "+t.type)}}}]),e}(),de=function(){function t(){a(this,t)}return u(t,null,[{key:"fromJSON",value:function(t){if(null===t||void 0===t)return null;if(t instanceof Date)return Number.isFinite(t.getTime())?t:null;if("string"!=typeof t&&!Number.isFinite(t))return null;var e=new Date;return e.setTime("string"==typeof t?Date.parse(t):t),Number.isFinite(e.getTime())?e:null}}]),t}(),ge=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,kt),u(e,[{key:"isValid",value:function(t,e,n){return e[n]instanceof Date&&Number.isFinite(e[n].getTime())}}]),e}(),ve=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,t),u(e,[{key:"set",value:function(t,n){return"validate_at"===t?(this[t]=de.fromJSON(n),this):c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"set",this).call(this,t,n)}},{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=null,this.core_version=null,this.width=null,this.height=null,this.validate_at=null,this.site_calibration=new At("SiteCalibration",null)}}],[{key:"getName",value:function(){return"Device"}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("site_calibration",new te),this._setPropertyValidator("core_version",new Pt([new Ct,new Ut])),this._setPropertyValidator("width",new Pt([new Ct,new Tt])),this._setPropertyValidator("height",new Pt([new Ct,new Tt])),this._setPropertyValidator("validate_at",new Pt([new Ct,new ge]))}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("type"),t.push("site_calibration"),t.push("core_version"),t.push("width"),t.push("height"),t.push("validate_at"),t}}]),e}(Dt(xt(Bt(Mt)))),me={KIOSK:"kiosk",MOBILE:"mobile",WEB:"web"},we=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,ve),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=me.KIOSK,this.position=new wt,this.os=null,this.location=null}}],[{key:"getName",value:function(){return"Kiosk"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("type",new ce(me.KIOSK)),this._setPropertyValidator("position",new ne),this._setPropertyValidator("os",new Pt([new Ut,new Ct])),this._setPropertyValidator("location",new Pt([new Ut,new Ct]))}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("position"),t.push("os"),t.push("location"),t}}]),e}(),be=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,ve),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=me.MOBILE}}],[{key:"getName",value:function(){return"Mobile"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("type",new ce(me.MOBILE))}}]),e}(),Oe=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,ve),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=me.WEB}}],[{key:"getName",value:function(){return"Web"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("type",new ce(me.WEB))}}]),e}(),ke=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Zt),u(e,null,[{key:"getEntityClass",value:function(){return ve}},{key:"fromJSON",value:function(t){if("object"!==(void 0===t?"undefined":s(t))||null===t)throw new TypeError("Expected an object");switch(t.type){case"kiosk":return new we(t);case"mobile":return new be(t);case"web":return new Oe(t);default:throw new Error("Unable to parse Device "+t.type)}}}]),e}(),Pe=function(t){return function(e){function n(){return a(this,n),p(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return h(n,t),u(n,[{key:"set",value:function(t,e){return"created_at"===t||"updated_at"===t?(this[t]=de.fromJSON(e),this):c(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"set",this).call(this,t,e)}},{key:"_reset",value:function(){c(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"_reset",this).call(this),this.version=null,this.created_at=null,this.updated_at=null}}],[{key:"keys",get:function(){var t=c(n.__proto__||Object.getPrototypeOf(n),"keys",this);return t.push("version"),t.push("created_at"),t.push("updated_at"),t}}]),n}()},Ee=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,t),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=null}}],[{key:"getName",value:function(){return"MapFile"}},{key:"_isAbstract",value:function(){return!0}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("type"),t}}]),e}(Dt(Pe(xt(fe(Bt(Mt)))))),Ce={AO_DAE:"aoDae",CONFIG:"config",DAE:"dae",HELPER:"helper",IVE:"ive",LIGHT:"light",OSG:"osg",PATH:"path"},je=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Ee),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=Ce.CONFIG}}],[{key:"getName",value:function(){return"MapConfig"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("type",new ce(Ce.CONFIG))}}]),e}(),Te=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Ee),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=Ce.DAE}}],[{key:"getName",value:function(){return"MapDae"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("type",new ce(Ce.DAE))}}]),e}(),Ve=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Ee),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=Ce.AO_DAE}}],[{key:"getName",value:function(){return"MapAoDae"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("type",new ce(Ce.AO_DAE))}}]),e}(),Ne=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Ee),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=Ce.LIGHT}}],[{key:"getName",value:function(){return"MapLight"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("type",new ce(Ce.LIGHT))}}]),e}(),Se=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Ee),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=Ce.HELPER}}],[{key:"getName",value:function(){return"MapHelper"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("type",new ce(Ce.HELPER))}}]),e}(),Re=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Ee),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=Ce.PATH,this.paths=new Map}}],[{key:"getName",value:function(){return"MapPath"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("type",new ce(Ce.PATH))}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("paths"),t}}]),e}(),Ae=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Zt),u(e,null,[{key:"getEntityClass",value:function(){return Ee}},{key:"fromJSON",value:function(t){if("object"!==(void 0===t?"undefined":s(t))||null===t)throw new TypeError("Expected an object");switch(t.type){case"config":return new je(t);case"dae":return new Te(t);case"aoDae":return new Ve(t);case"light":return new Ne(t);case"helper":return new Se(t);case"path":return new Re(t);case"ive":case"osg":case"model":case"aoOsg":return null;default:throw new Error("Unable to parse MapFile "+t.type)}}},{key:"_endpoint",get:function(){return"map"}}]),e}(),Fe=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,kt),u(e,[{key:"isValid",value:function(t,e,n){return"string"==typeof e[n]}}]),e}(),Ie=function(t){return function(e){function n(){return a(this,n),p(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return h(n,t),u(n,[{key:"_reset",value:function(){c(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"_reset",this).call(this),this.description=null}}],[{key:"_buildValidators",value:function(){c(n.__proto__||Object.getPrototypeOf(n),"_buildValidators",this).call(this),this._setPropertyValidator("description",new Pt([new Ct,new Fe]))}},{key:"keys",get:function(){var t=c(n.__proto__||Object.getPrototypeOf(n),"keys",this);return t.push("description"),t}}]),n}()},Le=function(t){return function(e){function n(){return a(this,n),p(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return h(n,t),u(n,[{key:"_reset",value:function(){c(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"_reset",this).call(this),this.signature=null}}],[{key:"keys",get:function(){var t=c(n.__proto__||Object.getPrototypeOf(n),"keys",this);return t.push("signature"),t}}]),n}()},Me=function(t){return function(e){function n(){return a(this,n),p(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return h(n,t),u(n,[{key:"_reset",value:function(){c(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"_reset",this).call(this),this.client_id=null}}],[{key:"_buildValidators",value:function(){c(n.__proto__||Object.getPrototypeOf(n),"_buildValidators",this).call(this),this._setPropertyValidator("client_id",new Pt([new Ct,new Ut]))}},{key:"keys",get:function(){var t=c(n.__proto__||Object.getPrototypeOf(n),"keys",this);return t.push("client_id"),t}}]),n}()},xe=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,kt),u(e,[{key:"isValid",value:function(t,e,n){var r=e[n];if(!(r instanceof Ft))return!1;var o=!0;return r.forEach(function(e){if(null!==e){var n=new At(r.classOf,e);te.isReference(t,n)&&!n.is(null)||(o=!1)}else o=!1}),o}}]),e}(),Ue=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,kt),u(e,[{key:"isValid",value:function(t,e,n){var r=e[n];if(!(r instanceof It))return!1;var o=!0;return r.forEach(function(e){if(null!==e){var n=new At(r.classOf,e);te.isReference(t,n)&&!n.is(null)||(o=!1)}else o=!1}),o}}]),e}(),De=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,t),u(e,[{key:"set",value:function(t,n){return"start_at"!==t&&"end_at"!==t?c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"set",this).call(this,t,n):(this[t]=de.fromJSON(n),this)}},{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=null,this.start_at=null,this.end_at=null,this.tags=new Ft("Tag"),this.playlists=new It("Playlist"),this.pois=new Ft("Poi"),this.preview=new At("File",null)}}],[{key:"getName",value:function(){return"Media"}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("tags",new xe),this._setPropertyValidator("playlists",new Ue),this._setPropertyValidator("pois",new xe),this._setPropertyValidator("preview",new te),this._setPropertyValidator("start_at",new Pt([new Ct,new ge])),this._setPropertyValidator("end_at",new Pt([new Ct,new ge]))}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("type"),t.push("tags"),t.push("playlists"),t.push("pois"),t.push("preview"),t.push("start_at"),t.push("end_at"),t}}]),e}(Me(Le(Pe(Ie(Dt(xt(Bt(Mt)))))))),Be={IMAGE:"image",PDF:"pdf",TEXT:"text",URL:"url",VIDEO:"video",MOVIE:"movie"},He=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,De),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=Be.TEXT,this.format=null,this.identifier=null,this.content=null}}],[{key:"getName",value:function(){return"MediaText"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("type",new ce(Be.TEXT)),this._setPropertyValidator("format",new Pt([new Ct,new Ut])),this._setPropertyValidator("identifier",new Pt([new Ct,new Ut])),this._setPropertyValidator("content",new Pt([new Ct,new Ut]))}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("format"),t.push("identifier"),t.push("content"),t}}]),e}(),qe=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,t),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=Be.IMAGE}}],[{key:"getName",value:function(){return"MediaImage"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("type",new ce(Be.IMAGE))}}]),e}(fe(De)),Je=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,t),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=Be.PDF}}],[{key:"getName",value:function(){return"MediaPdf"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("type",new ce(Be.PDF))}}]),e}(fe(De)),We=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,De),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=Be.URL,this.link=null}}],[{key:"getName",value:function(){return"MediaUrl"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("type",new ce(Be.URL)),this._setPropertyValidator("link",new Ut)}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("link"),t}}]),e}(),ze=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,t),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=Be.VIDEO}}],[{key:"getName",value:function(){return"MediaVideo"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("type",new ce(Be.VIDEO))}}]),e}(fe(De)),Ge=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;a(this,e);var n=p(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.validator=t,n}return h(e,kt),u(e,[{key:"isValid",value:function(t,e,n){if(null===this.validator)return!0;if(!(e[n]instanceof Set))return!1;for(var r=Array.from(e[n]),o=0;o<r.length;o++)if(!this.validator.isValid(t,r,o))return!1;return!0}}]),e}(),Xe=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,t),u(e,[{key:"set",value:function(t,n){if("coming_sessions"!==t)return c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"set",this).call(this,t,n);var r=[];return n.forEach(function(t){var e=de.fromJSON(t);r.push(e)}),St.set(this.coming_sessions,r),this}},{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=Be.MOVIE,this.actors=new Set,this.coming_sessions=new Set,this.director=null,this.certification=null,this.duration=null}}],[{key:"getName",value:function(){return"Movie"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("type",new ce(Be.MOVIE)),this._setPropertyValidator("actors",new Ge(new Fe)),this._setPropertyValidator("coming_sessions",new Ge(new ge)),this._setPropertyValidator("director",new Pt([new Ct,new Ut])),this._setPropertyValidator("certification",new Pt([new Ct,new Ut]))}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("actors"),t.push("coming_sessions"),t.push("director"),t.push("certification"),t.push("duration"),t}}]),e}(fe(De)),Ke=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Zt),u(e,null,[{key:"getEntityClass",value:function(){return De}},{key:"fromJSON",value:function(t){if("object"!==(void 0===t?"undefined":s(t))||null===t)throw new TypeError("Expected an object");switch(t.type){case"text":return new He(t);case"image":return new qe(t);case"pdf":return new Je(t);case"url":return new We(t);case"video":return new ze(t);case"movie":return new Xe(t);default:throw new Error("Unable to parse Media "+t.type)}}}]),e}(),Ye=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,t),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.categories=new Ft("Category"),this.children=new It("Poi"),this.custom_objects=new Ft("CustomObject"),this.logos=new It("File"),this.medias=new It("Media"),this.new=!0,this.parents=new Ft("Poi"),this.pictures=new It("File"),this.places=new Ft("Place"),this.tags=new Ft("Tag"),this.type=null}}],[{key:"getName",value:function(){return"Poi"}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("new",new oe),this._setPropertyValidator("categories",new xe),this._setPropertyValidator("custom_objects",new xe),this._setPropertyValidator("places",new xe),this._setPropertyValidator("tags",new xe),this._setPropertyValidator("parents",new xe),this._setPropertyValidator("children",new Ue),this._setPropertyValidator("logos",new Ue),this._setPropertyValidator("pictures",new Ue),this._setPropertyValidator("medias",new Ue)}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("type"),t.push("new"),t.push("categories"),t.push("custom_objects"),t.push("places"),t.push("tags"),t.push("parents"),t.push("children"),t.push("logos"),t.push("pictures"),t.push("medias"),t}}]),e}(Ie(Dt(Pe(Bt(Le(Me(xt(Mt)))))))),$e={EXHIBITOR:"exhibitor",PERSON:"person",PRODUCT:"product",ROOM:"room",SERVICE:"service",STORE:"store"},Qe=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Ye),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=$e.EXHIBITOR,this.phone=null,this.url=null}}],[{key:"getName",value:function(){return"Exhibitor"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("type",new ce($e.EXHIBITOR)),this._setPropertyValidator("phone",new Pt([new Ct,new Ut])),this._setPropertyValidator("url",new Pt([new Ct,new Ut]))}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("phone"),t.push("url"),t}}]),e}(),Ze=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Ye),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=$e.PERSON,this.firstname=null,this.lastname=null,this.desk_phone=null,this.mobile_phone=null}}],[{key:"getName",value:function(){return"Person"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("type",new ce($e.PERSON)),this._setPropertyValidator("firstname",new Pt([new Ct,new Ut])),this._setPropertyValidator("lastname",new Pt([new Ct,new Ut])),this._setPropertyValidator("desk_phone",new Pt([new Ct,new Ut])),this._setPropertyValidator("mobile_phone",new Pt([new Ct,new Ut]))}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("firstname"),t.push("lastname"),t.push("desk_phone"),t.push("mobile_phone"),t}}]),e}(),tn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Ye),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=$e.PRODUCT,this.brand_name=null,this.currency=null,this.description1=null,this.description2=null,this.discount_value=null,this.ean=null,this.full_description=null,this.full_name=null,this.price=null,this.priority=null,this.rating=null,this.rating_count=null,this.reference=null,this.remaining_quantity=null,this.status=null,this.url=null,this.values=new Ft("FeatureValue")}}],[{key:"getName",value:function(){return"Product"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("type",new ce($e.PRODUCT)),this._setPropertyValidator("priority",new Pt([new Ct,new Tt])),this._setPropertyValidator("reference",new Pt([new Ct,new Ut])),this._setPropertyValidator("full_name",new Pt([new Ct,new Ut])),this._setPropertyValidator("description1",new Pt([new Ct,new Fe])),this._setPropertyValidator("description2",new Pt([new Ct,new Fe])),this._setPropertyValidator("full_description",new Pt([new Ct,new Fe])),this._setPropertyValidator("brand_name",new Pt([new Ct,new Ut])),this._setPropertyValidator("url",new Pt([new Ct,new Ut])),this._setPropertyValidator("status",new Pt([new Ct,new Ut])),this._setPropertyValidator("price",new Pt([new Ct,new re])),this._setPropertyValidator("currency",new Pt([new Ct,new Ut])),this._setPropertyValidator("rating",new Pt([new Ct,new re])),this._setPropertyValidator("rating_count",new Pt([new Ct,new Tt])),this._setPropertyValidator("remaining_quantity",new Pt([new Ct,new Tt])),this._setPropertyValidator("discount_value",new Pt([new Ct,new Tt])),this._setPropertyValidator("ean",new Pt([new Ct,new he(/^[0-9]{8,13}$/)])),this._setPropertyValidator("values",new xe)}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("priority"),t.push("reference"),t.push("full_name"),t.push("description1"),t.push("description2"),t.push("full_description"),t.push("brand_name"),t.push("url"),t.push("status"),t.push("price"),t.push("currency"),t.push("rating"),t.push("rating_count"),t.push("remaining_quantity"),t.push("discount_value"),t.push("ean"),t.push("values"),t}}]),e}(),en=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Ye),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=$e.ROOM,this.reference=null,this.kind=null,this.capacity=null,this.phone=null}}],[{key:"getName",value:function(){return"Room"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("type",new ce($e.ROOM)),this._setPropertyValidator("reference",new Pt([new Ct,new Ut])),this._setPropertyValidator("kind",new Pt([new Ct,new Ut])),this._setPropertyValidator("capacity",new Pt([new Ct,new Tt])),this._setPropertyValidator("phone",new Pt([new Ct,new Ut]))}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("reference"),t.push("kind"),t.push("capacity"),t.push("phone"),t}}]),e}(),nn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Ye),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=$e.SERVICE,this.schedule=new Map}}],[{key:"getName",value:function(){return"Service"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("type",new ce($e.SERVICE))}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("schedule"),t}}]),e}(),rn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Ye),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.type=$e.STORE,this.priority=0,this.opening_time=null,this.phone=null,this.url=null}}],[{key:"getName",value:function(){return"Store"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("type",new ce($e.STORE)),this._setPropertyValidator("priority",new Tt),this._setPropertyValidator("opening_time",new Pt([new Ct,new Fe])),this._setPropertyValidator("phone",new Pt([new Ct,new Ut])),this._setPropertyValidator("url",new Pt([new Ct,new Ut]))}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("priority"),t.push("opening_time"),t.push("phone"),t.push("url"),t}}]),e}(),on=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Zt),u(e,[{key:"_switchType",value:function(t,n,r){if(null!==n.signature){var o=n.clone();o.signature=null,this._persist(o,r)}c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_switchType",this).call(this,t,n,r)}}],[{key:"getEntityClass",value:function(){return Ye}},{key:"fromJSON",value:function(t){if("object"!==(void 0===t?"undefined":s(t))||null===t)throw new TypeError("Expected an object");switch(t.type){case"exhibitor":return new Qe(t);case"person":return new Ze(t);case"product":return new tn(t);case"room":return new en(t);case"service":return new nn(t);case"store":return new rn(t);default:throw new Error("Unable to parse Poi "+t.type)}}}]),e}(),sn=function(t){return function(e){function n(){return a(this,n),p(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return h(n,t),u(n,[{key:"_reset",value:function(){c(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"_reset",this).call(this),this.logo=new At("File",null)}}],[{key:"_buildValidators",value:function(){c(n.__proto__||Object.getPrototypeOf(n),"_buildValidators",this).call(this),this._setPropertyValidator("logo",new te)}},{key:"keys",get:function(){var t=c(n.__proto__||Object.getPrototypeOf(n),"keys",this);return t.push("logo"),t}}]),n}()},an=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,t),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.color=null,this.rank=0,this.type=null,this.parameters=new Set,this.parents=new Ft("Category"),this.children=new It("Category"),this.pois=new Ft("Poi"),this.tags=new Ft("Tag")}}],[{key:"getName",value:function(){return"Category"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("color",new Pt([new Ct,new he(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/)])),this._setPropertyValidator("parameters",new Ge(new Fe)),this._setPropertyValidator("parents",new xe),this._setPropertyValidator("children",new Ue),this._setPropertyValidator("pois",new xe),this._setPropertyValidator("tags",new xe),this._setPropertyValidator("rank",new Tt),this._setPropertyValidator("type",new Pt([new Ut,new Ct]))}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("children"),t.push("color"),t.push("parameters"),t.push("parents"),t.push("pois"),t.push("rank"),t.push("type"),t.push("tags"),t}}]),e}(xt(Pe(Bt(sn(Me(Le(Dt(Mt)))))))),un=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Zt),u(e,null,[{key:"getEntityClass",value:function(){return an}}]),e}(),ln=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,t),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.values=new Ft("FeatureValue"),this.parents=new Ft("Feature"),this.children=new It("Feature")}}],[{key:"getName",value:function(){return"Feature"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("values",new xe),this._setPropertyValidator("parents",new xe),this._setPropertyValidator("children",new Ue)}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("values"),t.push("parents"),t.push("children"),t}}]),e}(xt(Bt(Le(Me(Dt(Mt)))))),cn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Zt),u(e,null,[{key:"getEntityClass",value:function(){return ln}}]),e}(),hn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,t),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.rank=0,this.unit=null,this.feature=new At("Feature",null),this.products=new Ft("Product")}}],[{key:"getName",value:function(){return"FeatureValue"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("feature",new te),this._setPropertyValidator("products",new xe),this._setPropertyValidator("rank",new Tt),this._setPropertyValidator("unit",new Pt([new Ct,new Ut]))}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("feature"),t.push("products"),t.push("rank"),t.push("unit"),t}}]),e}(Le(Me(Dt(xt(Bt(Mt)))))),pn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Zt),u(e,null,[{key:"getEntityClass",value:function(){return hn}},{key:"_endpoint",get:function(){return"feature-value"}}]),e}(),fn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Zt),u(e,null,[{key:"getEntityClass",value:function(){return Gt}}]),e}(),_n=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,fn),u(e,[{key:"_getCreateRequest",value:function(t){if(null===t.uri.match(/^blob/))return c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_getCreateRequest",this).call(this,t);var n=new FormData;n.set("name",t.name),n.set("context",t.context);var r=Gt._getBlobFromUri(t.uri);n.set("file",r,r instanceof File?r.name:"blob"),n.set("site",t.site.value);var o=new $t;return o.method="POST",o.url=this.options.getEndpoint()+"/"+this.constructor._endpoint,o.data=n,o}},{key:"_getUpdateRequest",value:function(t,n){if(-1===n.indexOf("uri")||null===Gt._getBlobFromUri(t.uri))return c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_getUpdateRequest",this).call(this,t,n);var r=new FormData;-1!==n.indexOf("name")&&r.set("name",t.name),-1!==n.indexOf("context")&&r.set("context",t.context),r.set("file",Gt._getBlobFromUri(t.uri)),-1!==n.indexOf("site")&&r.set("site",t.site.value);var o=new $t;return o.method="POST",o.url=this.options.getEndpoint()+"/"+this.constructor._endpoint+"/"+t.id,o.data=r,o}}]),e}(),yn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,t),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.floor_id=null,this.eye=new wt,this.target=new wt,this.up=new wt,this.zoom_max=null,this.zoom_min=null,this.site_calibration=new At("SiteCalibration",null)}}],[{key:"getName",value:function(){return"FloorCalibration"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("site_calibration",new ee),this._setPropertyValidator("floor_id",new Tt),this._setPropertyValidator("eye",new ne),this._setPropertyValidator("target",new ne),this._setPropertyValidator("up",new ne),this._setPropertyValidator("zoom_min",new Pt([new Ct,new re])),this._setPropertyValidator("zoom_max",new Pt([new Ct,new re]))}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("site_calibration"),t.push("floor_id"),t.push("eye"),t.push("target"),t.push("up"),t.push("zoom_min"),t.push("zoom_max"),t}}]),e}(xt(Bt(Mt))),dn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Zt),u(e,null,[{key:"getEntityClass",value:function(){return yn}}]),e}(),gn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,t),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.building_id=null,this.floor_id=null,this.shape_id=null,this.position=new wt,this.pois=new Ft("Poi"),this.custom_objects=new Ft("CustomObject")}}],[{key:"getName",value:function(){return"Place"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("pois",new xe),this._setPropertyValidator("custom_objects",new xe),this._setPropertyValidator("building_id",new Pt([new Ct,new Tt])),this._setPropertyValidator("floor_id",new Pt([new Ct,new Tt])),this._setPropertyValidator("shape_id",new Pt([new Ct,new Tt])),this._setPropertyValidator("position",new ne)}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("pois"),t.push("custom_objects"),t.push("building_id"),t.push("floor_id"),t.push("shape_id"),t.push("position"),t}}]),e}(Pe(Le(Dt(xt(Bt(Mt)))))),vn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Zt),u(e,null,[{key:"getEntityClass",value:function(){return gn}}]),e}(),mn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,t),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.tags=new Ft("Tag"),this.medias=new It("Media"),this.parameters=new Set}}],[{key:"getName",value:function(){return"Playlist"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("tags",new xe),this._setPropertyValidator("medias",new Ue),this._setPropertyValidator("parameters",new Ge(new Fe))}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("tags"),t.push("medias"),t.push("parameters"),t}}]),e}(xt(Pe(Le(Me(Ie(Dt(Bt(Mt)))))))),wn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Zt),u(e,null,[{key:"getEntityClass",value:function(){return mn}}]),e}(),bn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,t),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.device=new At("Device",null),this.floor_calibrations=new Ft("FloorCalibration"),this.start_floor=null,this.start_point_floor=null,this.start_point_position=new wt}}],[{key:"getName",value:function(){return"SiteCalibration"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("device",new ee),this._setPropertyValidator("floor_calibrations",new xe),this._setPropertyValidator("start_floor",new Tt),this._setPropertyValidator("start_point_floor",new Pt([new Tt,new Ct])),this._setPropertyValidator("start_point_position",new Pt([new ne,new Ct]))}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("device"),t.push("floor_calibrations"),t.push("start_floor"),t.push("start_point_floor"),t.push("start_point_position"),t}}]),e}(xt(Bt(Mt))),On=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Zt),u(e,null,[{key:"getEntityClass",value:function(){return bn}}]),e}(),kn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,kt),u(e,[{key:"isValid",value:function(t,e,n){var r=e[n];return"object"===(void 0===r?"undefined":s(r))&&null!==r&&(Number.isFinite(r.x)&&Number.isFinite(r.y)&&Number.isFinite(r.z)&&Number.isFinite(r.latitude)&&Number.isFinite(r.longitude)&&Number.isFinite(r.altitude))}}]),e}(),Pn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,t),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.opening=null,this.direction=null,this.city=null,this.cp=null,this.address=null,this.phone=null,this.locale=null,this.languages=new Set,this.gps_positions=new Set,this.gps_transform=new Set,this.gps_translate=new Set,this.target_platforms=new Set}}],[{key:"getName",value:function(){return"Site"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("opening",new Pt([new Ct,new Fe])),this._setPropertyValidator("direction",new Pt([new Ct,new Fe])),this._setPropertyValidator("city",new Pt([new Ct,new Ut])),this._setPropertyValidator("cp",new Pt([new Ct,new Ut])),this._setPropertyValidator("address",new Pt([new Ct,new Ut])),this._setPropertyValidator("phone",new Pt([new Ct,new Ut])),this._setPropertyValidator("locale",new Pt([new Ct,new Ut])),this._setPropertyValidator("languages",new Ge(new Fe)),this._setPropertyValidator("gps_positions",new Ge(new kn)),this._setPropertyValidator("gps_transform",new Ge(new re)),this._setPropertyValidator("gps_translate",new Ge(new re)),this._setPropertyValidator("target_platforms",new Ge(new Fe))}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("opening"),t.push("direction"),t.push("city"),t.push("cp"),t.push("address"),t.push("phone"),t.push("locale"),t.push("languages"),t.push("gps_positions"),t.push("gps_transform"),t.push("gps_translate"),t.push("target_platforms"),t}}]),e}(Bt(Pe(sn(Le(Me((vt=Ie(Dt(Mt)),function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,vt),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.email=null}}],[{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("email",new Pt([new Ct,new Ut]))}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("email"),t}}]),e}()))))))),En=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Zt),u(e,[{key:"getCurrent",value:function(){return this.get(this.em.options.site)}},{key:"_getLoadRequest",value:function(){var t=new $t;return t.url=this.em.options.getEndpoint()+"/"+this.constructor._endpoint+"/"+this.em.options.site,t}},{key:"_loadFromApiIntoNewStorage",value:function(){var t=this;return this.em._xhr(this._getLoadRequest(),200).then(function(e){var n=new Qt;return n.store(t.constructor.fromJSON(e.data)),n})}}],[{key:"getEntityClass",value:function(){return Pn}}]),e}(),Cn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,t),u(e,[{key:"_reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_reset",this).call(this),this.categories=new Ft("Category"),this.medias=new Ft("Media"),this.pois=new Ft("Poi"),this.playlists=new Ft("Playlist")}}],[{key:"getName",value:function(){return"Tag"}},{key:"_isAbstract",value:function(){return!1}},{key:"_buildValidators",value:function(){c(e.__proto__||Object.getPrototypeOf(e),"_buildValidators",this).call(this),this._setPropertyValidator("categories",new xe),this._setPropertyValidator("medias",new xe),this._setPropertyValidator("pois",new xe),this._setPropertyValidator("playlists",new xe)}},{key:"keys",get:function(){var t=c(e.__proto__||Object.getPrototypeOf(e),"keys",this);return t.push("categories"),t.push("medias"),t.push("pois"),t.push("playlists"),t}}]),e}(Pe(Le(Dt(xt(Bt(Mt)))))),jn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Zt),u(e,null,[{key:"getEntityClass",value:function(){return Cn}}]),e}(),Tn=function(){function t(e){a(this,t),this._init(e)}return u(t,[{key:"_init",value:function(e){if(this.em=e,this.eventDispatcher=C,this.constructor===t)throw new TypeError("Cannot construct AbstractListener instances directly");this._subscribe()}},{key:"_subscribe",value:function(){var t=this.constructor.getEntityClass().getName(),e=this.em.getRepository(t);this.eventDispatcher.subscribe(e,j.CREATE,this.onCreate.bind(this)),this.eventDispatcher.subscribe(e,j.UPDATE,this.onUpdate.bind(this)),this.eventDispatcher.subscribe(e,j.REMOVE,this.onRemove.bind(this))}},{key:"onCreate",value:function(t){}},{key:"onUpdate",value:function(t){}},{key:"onRemove",value:function(t){}},{key:"_cascadeRemove",value:function(t,e,n){var r=this,o=this.em.getRepository(t[e].classOf);if(t[e]instanceof At){var i=o.get(t[e]);this.constructor._isAssociatedTo(t,i,n)&&o._remove(i,!0)}t[e]instanceof Ft&&t[e].forEach(function(e){var i=o.get(e);r.constructor._isAssociatedTo(t,i,n)&&o._remove(i,!0)}),t[e]instanceof It&&t[e].forEach(function(e){var i=e.id,s=o.get(i);r.constructor._isAssociatedTo(t,s,n)&&o._remove(s,!0)})}},{key:"_unsetFromInversed",value:function(t,e,n){var r=this.em.getRepository(t[e].classOf);if(t[e]instanceof At&&null!==t[e].value){var o=r.get(t[e]);if(null!==o){var i=o.clone();i[n]=null,r._persist(i,!0)}}t[e]instanceof Ft&&t[e].forEach(function(t){var e=r.get(t);if(null!==e){var o=e.clone();o[n]=null,r._persist(o,!0)}})}},{key:"_removeFromInversed",value:function(t,e,n){var r=this.em.getRepository(t[e].classOf);if(t[e]instanceof At&&null!==t[e].value){var o=r.get(t[e]);if(null!==o){var i=o.clone();i[n].remove(t),r._persist(i,!0)}}t[e]instanceof Ft&&t[e].forEach(function(e){var o=r.get(e);if(null!==o){var i=o.clone();i[n].remove(t),r._persist(i,!0)}}),t[e]instanceof It&&t[e].forEach(function(e){var o=e.id,i=r.get(o);if(null!==i){var s=i.clone();s[n].remove(t),r._persist(s,!0)}})}},{key:"_onManyToManyOrToLinkPropertyChange",value:function(t,e,n,r,o,i){var s=this,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=this.em.getRepository(t[n].classOf);t[n].forEach(function(o){null!==e&&e[n].has(o)||s.constructor._addToNewlyInversed(t,null,u,o,r,i)}),null!==e&&e[n].forEach(function(e){t[n].has(e)||(null!==a&&a(u.get(e),t),s.constructor._removeFromFormerInversed(t,u,e,r,o))})}},{key:"_onLinkToManyOrToLinkPropertyChange",value:function(t,e,n,r,o,i){var s=this,a=this.em.getRepository(t[n].classOf);t[n].forEach(function(o){var u=o.id,l=o.position;null!==e&&e[n].has(u)&&e[n].getPositionOf(u)===l||s.constructor._addToNewlyInversed(t,l,a,u,r,i)}),null!==e&&e[n].forEach(function(e){var i=e.id;t[n].has(i)||s.constructor._removeFromFormerInversed(t,a,i,r,o)})}},{key:"_onOneToManyPropertyChange",value:function(t,e,n,r,o,i){var s=this,a=this.em.getRepository(t[n].classOf);t[n].forEach(function(o){null!==e&&e[n].has(o)||s.constructor._setToNewlyInversed(t,a,o,r,i)}),null!==e&&e[n].forEach(function(e){!t[n].has(e)&&s.constructor._isAssociatedTo(t,a.get(e),r)&&s.constructor._unsetFromFormerInversed(t,a,e,r,o)})}},{key:"_onManyToOnePropertyChange",value:function(t,e,n,r,o,i){var s=this.em.getRepository(t[n].classOf);this.constructor._addToNewlyInversed(t,null,s,t[n],r,i),null!==e&&this.constructor._removeFromFormerInversed(t,s,e[n],r,o)}},{key:"_onOneToOnePropertyChange",value:function(t,e,n,r,o,i){var s=this.em.getRepository(t[n].classOf);r&&this.constructor._setToNewlyInversed(t,s,t[n],r,i),null!==e&&this.constructor._unsetFromFormerInversed(t,s,e[n],r,o)}}],[{key:"getEntityClass",value:function(){throw new TypeError("You need to implement static getEntityClass in AbstractListener inheritance")}},{key:"_isAssociatedTo",value:function(t,e,n){return null===n||null===e?Boolean(e):e[n]instanceof At&&e[n].is(t)?e[n].is(t):(e[n]instanceof Ft||e[n]instanceof It)&&e[n].has(t)}},{key:"_isPropertyChanged",value:function(t,e,n,r){return!!e.constructor.keys.includes(t)&&(null===n||-1!==r.indexOf(t))}},{key:"_addToNewlyInversed",value:function(t,e,n,r,o,i){if(o||i){var s=n.get(r);if(null!==s){var a=s.clone();o&&a[o].add(t,e),i&&i(a),n._persist(a,!0)}}}},{key:"_removeFromFormerInversed",value:function(t,e,n,r,o){if(r){var i=e.get(n);if(null!==i&&this._isAssociatedTo(t,i,r)){var s=i.clone();s[r].remove(t),o&&0===s[r].size?e._remove(s,!0):e._persist(s,!0)}}}},{key:"_setToNewlyInversed",value:function(t,e,n,r,o){if(r||o){var i=e.get(n);if(null!==i){var s=i.clone();r&&(s[r]=t),o&&o(s),e._persist(s,!0)}}}},{key:"_unsetFromFormerInversed",value:function(t,e,n,r,o){if(r||o){var i=e.get(n);if(null!==i&&this._isAssociatedTo(t,i,r)){var s=i.clone();o?e._remove(s,!0):(s[r]=null,e._persist(s,!0))}}}}]),t}(),Vn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Tn),u(e,[{key:"onCreate",value:function(t){this._onChange(t,null)}},{key:"onUpdate",value:function(t){this._onChange(t.current,t.previous,t.changes)}},{key:"onRemove",value:function(t){this._removeFromInversed(t,"place","custom_objects"),this._removeFromInversed(t,"poi","custom_objects"),t instanceof _e&&this._cascadeRemove(t,"file",null)}},{key:"_onChange",value:function(t,e,n){this.constructor._isPropertyChanged("place",t,e,n)&&this._onManyToOnePropertyChange(t,e,"place","custom_objects"),this.constructor._isPropertyChanged("poi",t,e,n)&&this._onManyToOnePropertyChange(t,e,"poi","custom_objects"),this.constructor._isPropertyChanged("file",t,e,n)&&this._onManyToOnePropertyChange(t,e,"file",null,!0,this.constructor._onNewFile)}}],[{key:"getEntityClass",value:function(){return se}},{key:"_onNewFile",value:function(t){t.context=qt.PICTO}}]),e}(),Nn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Tn),u(e,[{key:"onCreate",value:function(t){this._onChange(t,null)}},{key:"onUpdate",value:function(t){this._onChange(t.current,t.previous,t.changes)}},{key:"onRemove",value:function(t){this._cascadeRemove(t,"site_calibration","device")}},{key:"_onChange",value:function(t,e,n){this.constructor._isPropertyChanged("site_calibration",t,e,n)&&this._onOneToOnePropertyChange(t,e,"site_calibration","device",!0)}}],[{key:"getEntityClass",value:function(){return ve}}]),e}(),Sn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Tn),u(e,[{key:"onCreate",value:function(t){this._onChange(t,null)}},{key:"onUpdate",value:function(t){this._onChange(t.current,t.previous,t.changes)}},{key:"onRemove",value:function(t){this._cascadeRemove(t,"file",null)}},{key:"_onChange",value:function(t,e,n){this.constructor._isPropertyChanged("file",t,e,n)&&this._onManyToOnePropertyChange(t,e,"file",null,!0,this.constructor._onNewFile)}}],[{key:"getEntityClass",value:function(){return Ee}},{key:"_onNewFile",value:function(t){null!==t&&(t.context="map")}}]),e}(),Rn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Tn),u(e,[{key:"onCreate",value:function(t){this._onChange(t,null)}},{key:"onUpdate",value:function(t){this._onChange(t.current,t.previous,t.changes)}},{key:"onRemove",value:function(t){this._removeFromInversed(t,"tags","medias"),this._removeFromInversed(t,"playlists","medias"),this._removeFromInversed(t,"pois","medias"),(t instanceof qe||t instanceof ze||t instanceof Je||t instanceof Xe)&&this._cascadeRemove(t,"file",null),this._cascadeRemove(t,"preview",null)}},{key:"_onChange",value:function(t,e,n){this.constructor._isPropertyChanged("tags",t,e,n)&&this._onManyToManyOrToLinkPropertyChange(t,e,"tags","medias"),this.constructor._isPropertyChanged("playlists",t,e,n)&&this._onLinkToManyOrToLinkPropertyChange(t,e,"playlists","medias"),this.constructor._isPropertyChanged("pois",t,e,n)&&this._onManyToManyOrToLinkPropertyChange(t,e,"pois","medias"),this.constructor._isPropertyChanged("preview",t,e,n)&&this._onManyToOnePropertyChange(t,e,"preview",null,!0,this.constructor._onNewPreview),this.constructor._isPropertyChanged("file",t,e,n)&&this._onManyToOnePropertyChange(t,e,"file",null,!0,this.constructor._onNewFile)}}],[{key:"getEntityClass",value:function(){return De}},{key:"_onNewPreview",value:function(t){t.context="media_preview"}},{key:"_onNewFile",value:function(t){t.context="media_file"}}]),e}(),An=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Tn),u(e,[{key:"onCreate",value:function(t){this._onChange(t,null)}},{key:"onUpdate",value:function(t){this._onChange(t.current,t.previous,t.changes)}},{key:"onRemove",value:function(t){this._removeFromInversed(t,"parents","children"),this._removeFromInversed(t,"children","parents"),this._removeFromInversed(t,"categories","pois"),this._removeFromInversed(t,"tags","pois"),this._removeFromInversed(t,"medias","pois"),this._removeFromInversed(t,"places","pois"),this._cascadeRemove(t,"custom_objects","poi"),t instanceof tn&&this._removeFromInversed(t,"values","products")}},{key:"_onChange",value:function(t,e,n){this.constructor._isPropertyChanged("name",t,e,n)&&this._onNameUpdated(t),this.constructor._isPropertyChanged("parents",t,e,n)&&this._onManyToManyOrToLinkPropertyChange(t,e,"parents","children"),this.constructor._isPropertyChanged("children",t,e,n)&&this._onLinkToManyOrToLinkPropertyChange(t,e,"children","parents"),this.constructor._isPropertyChanged("categories",t,e,n)&&this._onManyToManyOrToLinkPropertyChange(t,e,"categories","pois"),this.constructor._isPropertyChanged("tags",t,e,n)&&this._onManyToManyOrToLinkPropertyChange(t,e,"tags","pois"),this.constructor._isPropertyChanged("medias",t,e,n)&&this._onLinkToManyOrToLinkPropertyChange(t,e,"medias","pois"),this.constructor._isPropertyChanged("places",t,e,n)&&this._onManyToManyOrToLinkPropertyChange(t,e,"places","pois",!1,null,this._onPlaceRemoved.bind(this)),this.constructor._isPropertyChanged("custom_objects",t,e,n)&&this._onOneToManyPropertyChange(t,e,"custom_objects","poi",!1,this._onNewCustomObject.bind(this)),this.constructor._isPropertyChanged("logos",t,e,n)&&(this._onLinkToManyOrToLinkPropertyChange(t,e,"logos",null,!0,this.constructor._onNewLogo),this.constructor._onLogoUpdated(t,this.em)),this.constructor._isPropertyChanged("pictures",t,e,n)&&this._onLinkToManyOrToLinkPropertyChange(t,e,"pictures",null,!0,this.constructor._onNewPicture),this.constructor._isPropertyChanged("values",t,e,n)&&this._onManyToManyOrToLinkPropertyChange(t,e,"values","products")}},{key:"_onNameUpdated",value:function(t){var e=this;this.em.getRepository(t.custom_objects.classOf).getList(t.custom_objects).forEach(function(n){n instanceof pe&&e._updateLabelNameFromPoi(n,t)})}},{key:"_onPlaceRemoved",value:function(t,e){var n=this.em.getRepository(e.custom_objects.classOf);n.getList(e.custom_objects).forEach(function(e){null!==e&&e.place.is(t)&&n._remove(e,!0)})}},{key:"_onNewCustomObject",value:function(t){var e=this.em.getRepository("Poi").get(t.poi);if(t instanceof pe&&this._updateLabelNameFromPoi(t,e),t instanceof _e){var n=this.constructor._getFirstPoiLogo(e,this.em);this.constructor._updatePictoFileFromPoiLogo(t,n,this.em)}}},{key:"_updateLabelNameFromPoi",value:function(t,e){if(t.label!==e.name){var n=t.clone();n.label=e.name,this.em.getRepository("CustomObject")._persist(n,!0)}}}],[{key:"getEntityClass",value:function(){return Ye}},{key:"_onNewLogo",value:function(t){t.context="poi"}},{key:"_onNewPicture",value:function(t){t.context="poi"}},{key:"_onLogoUpdated",value:function(t,e){var n=this,r=e.getRepository(t.custom_objects.classOf).getList(t.custom_objects),o=this._getFirstPoiLogo(t,e);r.forEach(function(t){t instanceof _e&&n._updatePictoFileFromPoiLogo(t,o,e)})}},{key:"_isFirstLogo",value:function(t,e){return t.logos.size>0&&t.logos.values[0].id===e.id}},{key:"_getFirstPoiLogo",value:function(t,e){var n=e.getRepository(t.logos.classOf).getList(t.logos);return 0===n.length?null:n[0]}},{key:"_updatePictoFileFromPoiLogo",value:function(t,e,n){return null===e?(n.getRepository("CustomObject")._remove(t,!0),!1):null===e.content_hash?(n.logger.debug("PoiListener#_updatePictoFileFromPoiLogo: logo content hash is not computed, skipping"),!1):t.original_md5!==e.content_hash}}]),e}(),Fn=function(){function t(e){a(this,t),this.src={uri:e,image:null,width:null,height:null},this.target={uri:null,image:null,width:null,height:null,offset:{x:0,y:0}}}return u(t,[{key:"init",value:function(){return Promise.reject(new Error("ImageResizer is not available on NodeJS"))}},{key:"isSrcPowerOfTwo",value:function(){return this.isPowerOfTwoNumber(this.src.width)&&this.isPowerOfTwoNumber(this.src.height)}},{key:"isTargetPowerOfTwo",value:function(){return this.isPowerOfTwoNumber(this.target.width)&&this.isPowerOfTwoNumber(this.target.height)}},{key:"isPowerOfTwoNumber",value:function(t){return t>1&&0==(t&t-1)}},{key:"getNextPowerOfTwoNumber",value:function(t){for(var e=2;e<t;)e*=2;return e}},{key:"getWidthStretching",value:function(){return this.target.width/(this.target.width-2*this.target.offset.x)}},{key:"getHeightStretching",value:function(){return this.target.height/(this.target.height-2*this.target.offset.y)}},{key:"makePowerOfTwo",value:function(){if(!this.isTargetPowerOfTwo()){var t=this.isPowerOfTwoNumber(this.target.width),e=this.isPowerOfTwoNumber(this.target.height),n=this.getNextPowerOfTwoNumber(this.target.width),r=this.getNextPowerOfTwoNumber(this.target.height);if(!e&&!t)return this.resize(Math.max(n,r),!0),void this.makePowerOfTwo();e?(this.target.offset.x=Math.round((n-this.target.width)/2),this.target.width=n):(this.target.offset.y=Math.round((r-this.target.height)/2),this.target.height=r),this.resize()}}},{key:"resize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:512;if(!(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])&&this.target.width<t&&this.target.height<t)){var e=void 0;e=this.target.height>this.target.width?t/this.target.height:t/this.target.width,this.target.width=Math.round(this.target.width*e),this.target.height=Math.round(this.target.height*e),this.target.offset.x=Math.round(this.target.offset.x*e),this.target.offset.y=Math.round(this.target.offset.y*e)}}},{key:"save",value:function(){return Promise.reject(new Error("ImageResizer is not available on NodeJS"))}}]),t}(),In=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Fn),u(e,[{key:"init",value:function(){var t=this;return new Promise(function(e,n){try{var r=new Image;r.onload=function(){t.src.image=r,t.src.width=r.width,t.src.height=r.height,t.target.width=r.width,t.target.height=r.height,e()},r.onerror=function(t){n(t)},r.src=t.src.uri}catch(t){n(t)}})}},{key:"save",value:function(){var t=this;return new Promise(function(e,n){try{var r=document.createElement("canvas");r.width=t.target.width,r.height=t.target.height,r.getContext("2d").drawImage(t.src.image,t.target.offset.x,t.target.offset.y,t.target.width/t.getWidthStretching(),t.target.height/t.getHeightStretching()),r.toBlob(function(n){var r=URL.createObjectURL(n);Gt._addBlobUri(r,n),t.target.uri=r,e(r)})}catch(t){n(t)}})}}]),e}(),Ln=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,An),u(e,null,[{key:"_updatePictoFileFromPoiLogo",value:function(t,n,r){var o=this;if(!c(e.__proto__||Object.getPrototypeOf(e),"_updatePictoFileFromPoiLogo",this).call(this,t,n,r)){var i=r.getRepository("Poi"),s=r.getRepository("CustomObject"),a=r.getRepository("File"),u=a.get(n);if(null!==u){var l=new In(u.uri),h=l.init().then(function(){return l.makePowerOfTwo(),l.save()}).then(function(e){var c=s.get(t),h=i.get(c.poi);u=a.get(u);var p=a.get(c.file);if(null!==c&&null!==h&&null!==u&&o._isFirstLogo(h,u)){var f=c.clone();l.target.height/l.getHeightStretching()>l.target.width/l.getWidthStretching()?(f.height=Math.round(c.height*l.getHeightStretching()),f.width=Math.round(c.height*l.target.width/l.target.height)):(f.width=Math.round(c.width*l.getWidthStretching()),f.height=Math.round(c.width*l.target.height/l.target.width));var _=p.clone();_.uri=e,_.file_type=u.file_type,_.site=u.site;var y={resizer:{src:{width:l.src.width,height:l.src.height},target:{width:l.target.width,height:l.target.height}},picto:{src:{width:t.width,height:t.height},target:{width:f.width,height:f.height}}};r.logger.debug("PoiListener#_updatePictoFileFromPoiLogo: updating picto file",y),r.getRepository("File")._persist(_,!0),f.file=_,f.original_md5=n.content_hash,r.logger.debug("PoiListener#_updatePictoFileFromPoiLogo: updating picto",y),r.getRepository("CustomObject")._persist(f,!0)}}).catch(function(t){throw r.logger.warn("PoiListener#_updatePictoFileFromPoiLogo: Failed",{error:t}),t});r._waitFor(h)}}}}]),e}(),Mn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Tn),u(e,[{key:"onCreate",value:function(t){this._onChange(t,null)}},{key:"onUpdate",value:function(t){this._onChange(t.current,t.previous,t.changes)}},{key:"onRemove",value:function(t){this._removeFromInversed(t,"parents","children"),this._removeFromInversed(t,"children","parents"),this._removeFromInversed(t,"pois","categories"),this._removeFromInversed(t,"tags","categories"),this._cascadeRemove(t,"logo",null)}},{key:"_onChange",value:function(t,e,n){this.constructor._isPropertyChanged("parents",t,e,n)&&this._onManyToManyOrToLinkPropertyChange(t,e,"parents","children"),this.constructor._isPropertyChanged("children",t,e,n)&&this._onLinkToManyOrToLinkPropertyChange(t,e,"children","parents"),this.constructor._isPropertyChanged("pois",t,e,n)&&this._onManyToManyOrToLinkPropertyChange(t,e,"pois","categories"),this.constructor._isPropertyChanged("tags",t,e,n)&&this._onManyToManyOrToLinkPropertyChange(t,e,"tags","categories"),this.constructor._isPropertyChanged("logo",t,e,n)&&this._onManyToOnePropertyChange(t,e,"logo",null,!0,this.constructor._onNewLogo)}}],[{key:"getEntityClass",value:function(){return an}},{key:"_onNewLogo",value:function(t){null!==t&&(t.context=qt.CATEGORY)}}]),e}(),xn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Tn),u(e,[{key:"onCreate",value:function(t){this._onChange(t,null)}},{key:"onUpdate",value:function(t){this._onChange(t.current,t.previous,t.changes)}},{key:"onRemove",value:function(t){this._removeFromInversed(t,"parents","children"),this._removeFromInversed(t,"children","parents"),this._cascadeRemove(t,"values","feature")}},{key:"_onChange",value:function(t,e,n){this.constructor._isPropertyChanged("parents",t,e,n)&&this._onManyToManyOrToLinkPropertyChange(t,e,"parents","children"),this.constructor._isPropertyChanged("children",t,e,n)&&this._onLinkToManyOrToLinkPropertyChange(t,e,"children","parents"),this.constructor._isPropertyChanged("values",t,e,n)&&this._onManyToOnePropertyChange(t,e,"values","feature",!0)}}],[{key:"getEntityClass",value:function(){return ln}}]),e}(),Un=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Tn),u(e,[{key:"onCreate",value:function(t){this._onChange(t,null)}},{key:"onUpdate",value:function(t){this._onChange(t.current,t.previous,t.changes)}},{key:"onRemove",value:function(t){this._removeFromInversed(t,"products","values"),this._removeFromInversed(t,"feature","values")}},{key:"_onChange",value:function(t,e,n){this.constructor._isPropertyChanged("feature",t,e,n)&&this._onManyToOnePropertyChange(t,e,"feature","values"),this.constructor._isPropertyChanged("products",t,e,n)&&this._onManyToManyOrToLinkPropertyChange(t,e,"products","values")}}],[{key:"getEntityClass",value:function(){return hn}}]),e}(),Dn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Tn),u(e,[{key:"onCreate",value:function(t){this._onChange(t,null)}},{key:"onUpdate",value:function(t){this._onChange(t.current,t.previous,t.changes)}},{key:"onRemove",value:function(t){}},{key:"_onChange",value:function(t,e,n){this.constructor._isPropertyChanged("uri",t,e,n)&&this._onUriUpdated(t),this.constructor._isPropertyChanged("context",t,e,n)&&this._onContextUpdated(t),this.constructor._isPropertyChanged("content_hash",t,e,n)&&this._onContentHashUpdated(t)}},{key:"_onUriUpdated",value:function(t){t.context===qt.PICTO&&(this.em.logger.debug("FileListener#_onUriUpdated: make picto file pow2"),this._makePictoFilePow2(t)),this.em.logger.debug("FileListener#_onUriUpdated: force update content hash"),this._updateContentHash(t,!0)}},{key:"_onContentHashUpdated",value:function(t){if(t.context===qt.POI){var e=this.constructor._getPoiFromFile(t,this.em);null!==e&&Ln._getFirstPoiLogo(e,this.em)===t&&(this.em.logger.debug("FileListener#_onContentHashUpdated: update associated picto"),Ln._onLogoUpdated(e,this.em))}}},{key:"_onContextUpdated",value:function(t){t.context===qt.PICTO&&(this.em.logger.debug("FileListener#_onContextUpdated: make picto pow2"),this._makePictoFilePow2(t))}},{key:"_updateContentHash",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(null===t.content_hash||n){var r=$t.getUriContentHash(t.uri).then(function(n){var r=e.em.getRepository("File"),o=r.get(t);if(null!==o&&o.uri===t.uri){var i=o.clone();i.content_hash=n,r._persist(i,!0)}else e.em.logger.debug("FileListener#_updateContentHash: File has been removed or binary has been updated while computing ==> Skip")}).catch(function(t){throw t});this.em._waitFor(r)}}},{key:"_makePictoFilePow2",value:function(t){return this.em.logger.warn("Cannot make an image Pow2 yet"),Promise.resolve(!1)}}],[{key:"getEntityClass",value:function(){return Gt}},{key:"_getPictoFromFile",value:function(t,e){var n=e.getRepository("CustomObject").findBy({type:ae.PICTO,file:function(e){return e.is(t)}});return 0===n.length?null:n[0]}},{key:"_getPoiFromFile",value:function(t,e){var n=e.getRepository("Poi").findBy({logos:function(e){return e.has(t)}});return 0===n.length?null:n[0]}}]),e}(),Bn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Dn),u(e,[{key:"_makePictoFilePow2",value:function(t){var e=this,n=new In(t.uri),r=n.init().then(function(){return n.isSrcPowerOfTwo()?Promise.resolve(!0):(n.makePowerOfTwo(),n.save().then(function(r){var o=e.em.getRepository("File"),i=o.get(t);if(null!==i&&i.uri===t.uri&&i.context===qt.PICTO){var s=i.clone(),a=e.constructor._getPictoFromFile(i,e.em);if(null!==a){s.uri=r,s.content_hash=null;var u=a.clone();u.width=Math.round(a.width*n.getWidthStretching()),u.height=Math.round(a.height*n.getHeightStretching()),e.em.logger.debug("FileListener#_makePictoFilePow2: updating picto to fit new image",{src_picto:{width:a.width,height:a.height},target_picto:{width:u.width,height:u.height},src_file:{width:n.src.width,height:n.src.height},target_file:{width:n.target.width,height:n.target.height}}),e.em.getRepository("CustomObject")._persist(u,!0)}else s.context=qt.DEFAULT;e.em.logger.debug("FileListener#_makePictoFilePow2: updating picto file",{src_file:{width:n.src.width,height:n.src.height},target_file:{width:n.target.width,height:n.target.height}}),o._persist(s,!0)}}))}).catch(function(t){throw e.em.logger.warn("FileListener#_makePictoFilePow2: Failed",{error:t}),t});return this.em._waitFor(r),r}}],[{key:"_getPictoFromFile",value:function(t,e){var n=e.getRepository("CustomObject").findBy({type:ae.PICTO,file:function(e){return e.is(t)}});return 0===n.length?null:n[0]}},{key:"_getPoiFromFile",value:function(t,e){var n=e.getRepository("Poi").findBy({logos:function(e){return e.has(t)}});return 0===n.length?null:n[0]}}]),e}(),Hn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Tn),u(e,[{key:"onCreate",value:function(t){this._onChange(t,null)}},{key:"onUpdate",value:function(t){this._onChange(t.current,t.previous,t.changes)}},{key:"onRemove",value:function(t){this._removeFromInversed(t,"site_calibration","floor_calibrations")}},{key:"_onChange",value:function(t,e,n){this.constructor._isPropertyChanged("site_calibration",t,e,n)&&this._onManyToOnePropertyChange(t,e,"site_calibration","floor_calibrations")}}],[{key:"getEntityClass",value:function(){return yn}}]),e}(),qn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Tn),u(e,[{key:"onCreate",value:function(t){this._onChange(t,null)}},{key:"onUpdate",value:function(t){this._onChange(t.current,t.previous,t.changes)}},{key:"onRemove",value:function(t){this._removeFromInversed(t,"pois","places"),this._cascadeRemove(t,"custom_objects","place")}},{key:"_onChange",value:function(t,e,n){this.constructor._isPropertyChanged("pois",t,e,n)&&this._onManyToManyOrToLinkPropertyChange(t,e,"pois","places"),this.constructor._isPropertyChanged("custom_objects",t,e,n)&&this._onOneToManyPropertyChange(t,e,"custom_objects","place",!0)}}],[{key:"getEntityClass",value:function(){return gn}}]),e}(),Jn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Tn),u(e,[{key:"onCreate",value:function(t){this._onChange(t,null)}},{key:"onUpdate",value:function(t){this._onChange(t.current,t.previous,t.changes)}},{key:"onRemove",value:function(t){this._removeFromInversed(t,"medias","playlists"),this._removeFromInversed(t,"tags","playlists")}},{key:"_onChange",value:function(t,e,n){this.constructor._isPropertyChanged("medias",t,e,n)&&this._onLinkToManyOrToLinkPropertyChange(t,e,"medias","playlists"),this.constructor._isPropertyChanged("tags",t,e,n)&&this._onManyToManyOrToLinkPropertyChange(t,e,"tags","playlists")}}],[{key:"getEntityClass",value:function(){return mn}}]),e}(),Wn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Tn),u(e,[{key:"onCreate",value:function(t){this._onChange(t,null)}},{key:"onUpdate",value:function(t){this._onChange(t.current,t.previous,t.changes)}},{key:"onRemove",value:function(t){this._unsetFromInversed(t,"device","site_calibration"),this._cascadeRemove(t,"floor_calibrations","site_calibration")}},{key:"_onChange",value:function(t,e,n){this.constructor._isPropertyChanged("floor_calibrations",t,e,n)&&this._onOneToManyPropertyChange(t,e,"floor_calibrations","site_calibration",!0),this.constructor._isPropertyChanged("device",t,e,n)&&this._onOneToOnePropertyChange(t,e,"device","site_calibration")}}],[{key:"getEntityClass",value:function(){return bn}}]),e}(),zn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Tn),u(e,[{key:"onCreate",value:function(t){this._onChange(t,null)}},{key:"onUpdate",value:function(t){this._onChange(t.current,t.previous,t.changes)}},{key:"onRemove",value:function(t){throw new TypeError("You cannot remove the Site !")}},{key:"_onChange",value:function(t,e,n){this.constructor._isPropertyChanged("logo",t,e,n)&&this._onManyToOnePropertyChange(t,e,"logo",null,!0,this.constructor._onNewLogo)}}],[{key:"getEntityClass",value:function(){return Pn}},{key:"_onNewLogo",value:function(t){null!==t&&(t.context="site")}}]),e}(),Gn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,Tn),u(e,[{key:"onCreate",value:function(t){this._onChange(t,null)}},{key:"onUpdate",value:function(t){this._onChange(t.current,t.previous,t.changes)}},{key:"onRemove",value:function(t){this._removeFromInversed(t,"categories","tags"),this._removeFromInversed(t,"pois","tags"),this._removeFromInversed(t,"playlists","tags"),this._removeFromInversed(t,"medias","tags")}},{key:"_onChange",value:function(t,e,n){this.constructor._isPropertyChanged("pois",t,e,n)&&this._onManyToManyOrToLinkPropertyChange(t,e,"pois","tags"),this.constructor._isPropertyChanged("categories",t,e,n)&&this._onManyToManyOrToLinkPropertyChange(t,e,"categories","tags"),this.constructor._isPropertyChanged("medias",t,e,n)&&this._onManyToManyOrToLinkPropertyChange(t,e,"medias","tags"),this.constructor._isPropertyChanged("playlists",t,e,n)&&this._onManyToManyOrToLinkPropertyChange(t,e,"playlists","tags")}}],[{key:"getEntityClass",value:function(){return Cn}}]),e}(),Xn=function(){function t(e){a(this,t),this.em=e,this.em.logger.debug("UnitOfWork: instantiate"),this._reset()}return u(t,[{key:"flush",value:function(){var t=this;this.em.logger.debug("UnitOfWork: flush start"),this._prepare();var e=new Set(this.commits)[Symbol.iterator]();return this._flushCommits(e).then(function(){return t._finish()})}},{key:"_reset",value:function(){this.em.logger.debug("UnitOfWork: reset"),this.commits=new Set,this._symbolToId=new Map,this._symbolToRepository=new Map}},{key:"_prepare",value:function(){this.em.logger.debug("UnitOfWork: prepare"),this._mergeConsecutiveCommits()}},{key:"_mergeConsecutiveCommits",value:function(){var t=this;this.em.logger.debug("UnitOfWork: merge commits");var e=new Set,n=null;this.commits.forEach(function(r){var o=t.constructor._mergeTwoConsecutiveCommits(n,r);switch(t.em.logger.debug("UnitOfWork: merge two consecutive commits",{previous:n,commit:r,merged:o}),o.length){case 0:n=null;break;case 1:var i=f(o,1);n=i[0];break;case 2:e.add(o[0]);var s=f(o,2);n=s[1];break;default:throw new Error("Unexpected")}}),null!==n&&e.add(n),this.commits=e}},{key:"_finish",value:function(){var t=this;this.em.logger.debug("UnitOfWork: finish");var e=new Set;return this._symbolToId.entries().forEach(function(n){var r=f(n,2),o=r[0],i=r[1],s=t._symbolToRepository.get(o);e.add({id:i,symbol:o,repository:s})}),this._reset(),e}},{key:"_replaceFileReferenceSymbolToId",value:function(t){"symbol"===s(t.value)&&(t.value=this._symbolToId.get(t.value))}},{key:"_replaceFileCollectionSymbolToId",value:function(t){var e=this;t.forEach(function(n){"symbol"===(void 0===n?"undefined":s(n))&&(t.add(e._symbolToId.get(n)),t.remove(n))})}},{key:"_replaceFileOrderedCollectionSymbolToId",value:function(t){var e=this;t.forEach(function(n){var r=f(n,2),o=r[0],i=r[1];"symbol"===(void 0===o?"undefined":s(o))&&(t.add(e._symbolToId.get(o),i),t.remove(o))})}},{key:"_flushCommits",value:function(t){var e=this,n=t.next(),r=n.value;return n.done?Promise.resolve():(this.em.logger.info("UnitOfWork: "+this.commits.size+" request to send"),this.em.logger.debug("UnitOfWork: flush commits start",{commit:r}),this._flushCommit(r).then(function(){return e.em.logger.debug("UnitOfWork: flush commits next",{commit:r}),e.commits.delete(r),e._flushCommits(t)}))}},{key:"_flushCommit",value:function(t){var e=f(t,3),n=e[0],r=e[1],o=e[2];switch(r){case j.CREATE:return this._flushCreateCommit(n,o);case j.UPDATE:return this._flushUpdateCommit(n,o.current,o.changes);case j.REMOVE:return this._flushRemoveCommit(n,o);default:return Promise.reject(new Error("UOW: Unhandled event "+r))}}},{key:"_flushCreateCommit",value:function(t,e){var n=this;this._replaceAssociatedSymbolToId(e);var r=t._getCreateRequest(e);return this.em._xhr(r,200).then(function(r){var o=r.data;return n._symbolToId.set(e.id,o.id),n._symbolToRepository.set(e.id,t),n.em.logger.debug("UnitOfWork: retrieved identifier",{symbol:e.id,id:o.id}),o.id})}},{key:"_flushUpdateCommit",value:function(t,e,n){this._replaceAssociatedSymbolToId(e);var r=t._getUpdateRequest(e,n);return this.em._xhr(r,204)}},{key:"_flushRemoveCommit",value:function(t,e){var n=this;e.forEach(function(t){n._replaceAssociatedSymbolToId(t)});for(var r=[],o=function(o){var i=e.slice(o,o+50),s=t._getRemoveRequest(i);r.push(n.em._xhr(s,204).catch(function(e){if(e instanceof Error)return Promise.reject(e);var r=e.data;if(!r.hasOwnProperty("errors"))return Promise.reject(new Error("Server error"));var o=r.errors;if(e.status>=500)return Promise.reject(o);n.em.logger.warn("UnitOfWork: flush remove commit invalid data supplied",{json:r});var s=Object.keys(o);if(1!==s.length||!s.includes("id"))return Promise.reject(o);for(var a=Object.keys(o.id).map(function(t){return parseInt(t.replace("#",""),10)}),u=[],l=0;l<i.length;l++)a.includes(l)||u.push(i[l]);return 0===u.length?Promise.resolve():n._flushRemoveCommit(t,u)}))},i=0;i<e.length;i+=50)o(i);return Promise.all(r)}},{key:"_replaceAssociatedSymbolToId",value:function(t){var e=this;this.em.logger.debug("UnitOfWork: replace associated symbol to id",{entity:t}),"symbol"===s(t.id)&&this._symbolToId.has(t.id)&&(t.id=this._symbolToId.get(t.id),this.em.logger.debug("UnitOfWork: replace associated symbol to id (own id replaced)",{entity:t})),t.constructor.keys.forEach(function(n){t[n]instanceof At&&e._replaceReferenceAssociatedSymbol(n,t),t[n]instanceof Ft&&e._replaceCollectionAssociatedSymbol(n,t),t[n]instanceof It&&e._replaceOrderedCollectionAssociatedSymbol(n,t)})}},{key:"_replaceReferenceAssociatedSymbol",value:function(t,e){var n=e[t].value;if("symbol"===(void 0===n?"undefined":s(n))){if(!this._symbolToId.has(n))throw this.em.logger.error("UnitOfWork: replace associated symbol to id (reference id not found)",{key:t}),new Error("Unable to find Symbol <--\x3e Id matching");this.em.logger.debug("UnitOfWork: replace associated symbol to id (reference id replaced)",{key:t}),e[t]=this._symbolToId.get(n)}}},{key:"_replaceCollectionAssociatedSymbol",value:function(t,e){var n=this,r=[];e[t].forEach(function(e){if("symbol"!==(void 0===e?"undefined":s(e)))r.push(e);else{if(!n._symbolToId.has(e))throw n.em.logger.error("UnitOfWork: replace associated symbol to id (collection item id not found)",{key:t}),new Error("Unable to find Symbol <--\x3e Id matching");n.em.logger.debug("UnitOfWork: replace associated symbol to id (collection item id replaced)",{key:t}),r.push(n._symbolToId.get(e))}}),e[t]=r}},{key:"_replaceOrderedCollectionAssociatedSymbol",value:function(t,e){var n=this,r=[];e[t].forEach(function(e){var o=e.id,i=e.position;if("symbol"!==(void 0===o?"undefined":s(o)))r.push({id:o,position:i});else{if(!n._symbolToId.has(o))throw n.em.logger.error("UnitOfWork: replace associated symbol to id (ordered collection item id not found)",{key:t}),new Error("Unable to find Symbol <--\x3e Id matching");n.em.logger.debug("UnitOfWork: replace associated symbol to id (ordered collection item id replaced)",{key:t}),r.push({id:n._symbolToId.get(o),position:i})}}),e[t]=r}},{key:"_hasPendingChanges",get:function(){return this._mergeConsecutiveCommits(),0!==this.commits.size}}],[{key:"_mergeTwoConsecutiveCommits",value:function(t,e){if(null===t)return[e];var n=f(t,3),r=n[0],o=n[1],i=n[2],s=f(e,3),a=s[0],u=s[1],l=s[2];if(r!==a)return[t,e];switch(o){case j.UPDATE:if(u===j.UPDATE&&i.current===l.previous){var c=i.previous,h=l.current,p=r.constructor._compare(c,h);return 0===p.length?[]:[[r,j.UPDATE,{current:h,previous:c,changes:p}]]}break;case j.CREATE:if(u===j.REMOVE&&l.includes(i))return[];if(u===j.UPDATE&&i===l.previous)return[[r,j.CREATE,l.current]];break;case j.REMOVE:if(u===j.REMOVE&&r===a)return[[r,j.REMOVE,[].concat(_(i),_(l))]];break;default:throw new Error("Unexpected")}return[t,e]}}]),t}(),Kn=[En,Ae,_n,un,on,cn,pn,vn,ye,wn,Ke,ke,On,dn,jn],Yn=[zn,Sn,Bn,Mn,Ln,xn,Un,qn,Vn,Jn,Rn,Nn,Wn,Hn,Gn],$n=function(){function t(e){a(this,t),this.options=null,this.logger=null,this._repositories=new Map,this._listeners=new Map,this.locale=null,this._uow=null,this.locked=!1,this._waiting=new Set,this._init(new b(e))}return u(t,null,[{key:"generateNonce",value:function(){var t=Date.now()*Math.random();return i(t.toString(),1)}},{key:"now",value:function(){return Math.round(Date.now()/1e3).toString()}}]),u(t,[{key:"_init",value:function(t){t.validate(),this.options=t,this.logger=this.options.logger,this.logger.info("EntityManager: instantiate",{options:t}),this._uow=new Xn(this);for(var e=0;e<Kn.length;e++)this._repositories.set(Kn[e].getName(),new Kn[e](this));for(var n=0;n<Yn.length;n++)this._listeners.set(Yn[n].getEntityClass().getName(),new Yn[n](this));this.locale=this.options.locale}},{key:"_lock",value:function(){this.logger.info("EntityManager: locked"),this.locked=!0}},{key:"_unlock",value:function(){this.logger.info("EntityManager: unlocked"),this.locked=!1}},{key:"hasPendingChanges",value:function(){return this._uow._hasPendingChanges}},{key:"isFullyLoaded",value:function(){for(var t=this.getRepositories(),e=0;e<t.length;e++){if(t[e]._status!==N)return!1}return!0}},{key:"getRepository",value:function(t){return this._repositories.has(t)?this._repositories.get(t):null}},{key:"getRepositoryNames",value:function(){return Array.from(this._repositories.keys())}},{key:"getRepositories",value:function(){return Array.from(this._repositories.values())}},{key:"load",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise(function(n,r){t.logger.info("EntityManager: loading start");var o=[];t.getRepositories().forEach(function(t){o.push(t.load(e))}),Promise.all(o).then(function(){t.logger.info("EntityManager: loading success"),n()},function(e){t.logger.error("EntityManager: loading failed",{error:e}),r(e)})})}},{key:"loadFromCache",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise(function(n,r){t.logger.info("EntityManager: loading start");var o=[];t.getRepositories().forEach(function(t){o.push(t.loadFromCache(e))}),Promise.all(o).then(function(){t.logger.info("EntityManager: loading success"),n()},function(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];t.logger.error("EntityManager: loading failed",{error:n}),r.apply(void 0,n)})})}},{key:"flush",value:function(){var t=this;return new Promise(function(e,n){t.options.state===w.PUBLISHED&&t.logger.warn("EntityManager: your are about to flush into PUBLISHED state"),t.logger.info("EntityManager: flush start"),t._assertIsNotLocked(),t._assertIsFullyLoaded(),t.logger.info("EntityManager: waiting listeners to be completed before send data"),t._wait().then(e,n)}).then(function(){return t._lock(),t._uow.flush()}).then(function(e){return t._unlock(),e.forEach(function(t){C.publish(t.repository,j.IDENTIFIER_WILL_CHANGE,[t.id,t.symbol])}),t.pull().then(function(){e.forEach(function(t){C.publish(t.repository,j.IDENTIFIER_DID_CHANGE,[t.id,t.symbol])})})}).catch(function(e){throw t.logger.error("EntityManager: flush failed",{error:e}),t._unlock(),e})}},{key:"pull",value:function(){var t=this;if(this.logger.info("EntityManager: pull start"),this.hasPendingChanges())throw this.logger.error("EntityManager: pull failed (pending changes)."),new Error("You cannot pull while there is unsaved modifications");this._lock();var e=[];return this.getRepositories().forEach(function(t){e.push(t._loadIntoNewStorage(!1).then(function(e){var n=t._replaceStorage(e);return[t,n]}))}),Promise.all(e).then(function(t){t.forEach(function(t){var e=f(t,2),n=e[0];e[1][j.REMOVE].forEach(function(t){C.publish(n,j.REMOVE,t)})}),t.forEach(function(t){var e=f(t,2),n=e[0];e[1][j.CREATE].forEach(function(t){C.publish(n,j.CREATE,t)})}),t.forEach(function(t){var e=f(t,2),n=e[0];e[1][j.UPDATE].forEach(function(t){C.publish(n,j.UPDATE,t)})})}).then(function(){t._unlock()}).catch(function(e){return t._unlock(),Promise.reject(e)})}},{key:"_assertIsFullyLoaded",value:function(){if(!this.isFullyLoaded())throw this.logger.error("EntityManager: not fully failed."),new TypeError("You need to fully load EntityManager to use write features")}},{key:"_assertIsNotLocked",value:function(){if(this.locked)throw this.logger.error("EntityManager: locked."),new Error("The EntityManager is locked, readonly operations are permitted")}},{key:"_xhr",value:function(t,e){var n=this;return t.addParameter("site",this.options.site),t.addHeaders(this.constructor.getHeaders(this.options.username,this.options.key,this.options.locale,this.options.state)),t.validateStatus=function(t){return t===e},$t.sendRequest(t).then(function(r){if(r.status!==e){var o="Unexpected status while requesting API\n\n                Got "+r.status+" instead of "+e+" on route "+t.formattedUrl();return n.logger.error(o,{response:r,request:t,expectedStatus:e}),Promise.reject(r)}return r}).catch(function(e){return n._onRequestError(e,t)})}},{key:"_onRequestError",value:function(t,e){var n=$t.formatApiError(t,e),r=n.message,o=n.context;return this.logger.error(r,o),Promise.reject(new Error(r))}},{key:"_waitFor",value:function(t){this._waiting.add(t.catch(function(){}))}},{key:"_wait",value:function(){var t=this,e=this._waiting;return this._waiting=new Set,0===e.size?Promise.resolve():Promise.all(e).then(function(){return t._wait()})}},{key:"wait",value:function(){return this._wait()}}],[{key:"getHeaders",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o={Authorization:'WSSE profile="UsernameToken"',"X-WSSE":this.getWsseHeader(t,e),"X-API-MODE":"get"};return null!==r&&(o["X-API-STATE"]=r),null!==n&&(o["X-API-LOCALE"]=n),o}},{key:"getWsseHeader",value:function(t,e){var n=this.generateNonce(),r=this.now();return'UsernameToken Username="'+t+'", PasswordDigest="'+o(n+r+e,1)+'", Nonce="'+n+'", Created="'+r+'"'}}]),t}(),Qn=function(t){function e(){return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return h(e,y),u(e,[{key:"reset",value:function(){c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"reset",this).call(this),this.endpoint=null,this.username=null,this.key=null,this.additionalLocales=null,this.state=w.PUBLISHED,this.binDownloadPolicy={ignoredContexts:[qt.TEXTURE_LOW,qt.TEXTURE_HELPER,qt.TEXTURE_MODEL],ignoredIds:[],ignoredFileType:[]}}},{key:"areSameAdditionalLocales",value:function(t){return t===this.additionalLocales||null!==t&&null!==this.additionalLocales&&this.constructor._areSameArrays(t,this.additionalLocales)}},{key:"areSameBinDownloadPolicy",value:function(t){return!!t&&(!!this.constructor._areSameArrays(t.ignoredContexts,this.binDownloadPolicy.ignoredContexts)&&(!!this.constructor._areSameArrays(t.ignoredIds,this.binDownloadPolicy.ignoredIds)&&this.constructor._areSameArrays(t.ignoredFileType,this.binDownloadPolicy.ignoredFileType)))}}],[{key:"_areSameArrays",value:function(t,e){if(t.length!==e.length)return!1;var n=!0;return t.forEach(function(t){n&&!e.includes(t)&&(n=!1)}),n}}]),e}(),Zn=function(){function t(e){a(this,t),this.directory=e,this.runningUpdates=new Map,this.runningClean=null}return u(t,null,[{key:"getTranslatableRepositories",value:function(){return[Pn.getName(),an.getName(),se.getName(),ln.getName(),hn.getName(),De.getName(),mn.getName(),Ye.getName(),Cn.getName()]}}]),u(t,[{key:"getLastPublishDate",value:function(t,e){if(e.state!==w.PUBLISHED)return Promise.resolve(new Date);var n=b.formatApiEndpoint(e.endpoint),r=new $t;return r.url=n+"/published-version/last/"+t,r.addHeaders($n.getHeaders(e.username,e.key)),$t.sendRequest(r).then(function(t){var e=t.data;return new Date(e.date)}).catch(function(t){if(!t.response)return null;if(t.response)switch(t.response.status){case 404:return new Date;case 503:return null}var e=$t.formatApiError(t,r).message;return Promise.reject(new Error(e))})}},{key:"getCacheMetadata",value:function(t){return this._readFile(this._getSiteCacheDirector(t)+"/metadata.json").then(function(t){return JSON.parse(t)}).catch(function(){return null})}},{key:"clean",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return null!==this.runningClean?this.runningClean:e&&this.runningUpdates.size>0?Promise.all(Array.from(this.runningUpdates.values())).then(function(){return t.clean()}):(this.runningClean=Promise.all([this._getBinRegistry(),this._readdir(this._getBinCacheDirector())]).then(function(e){var n=f(e,2),r=n[0],o=n[1],i=[];Object.keys(r).forEach(function(t){r[t].forEach(function(t){i.includes(t)||i.push(t)})});var s=[];return o.forEach(function(e){i.includes(e)||s.push(t._rmrf(t._getBinCacheDirector()+"/"+e))}),Promise.all(s).then(function(){t.runningClean=null})}),this.runningClean)}},{key:"_cleanUnusedBins",value:function(t,e){var n=this;return this._getBinRegistry().then(function(r){return r[t]=e,n._writeFile(n.directory+"/binRegistry.json",JSON.stringify(r))}).then(function(){return n.clean(!1)})}},{key:"_getBinRegistry",value:function(){return this._readFile(this.directory+"/binRegistry.json").then(function(t){return JSON.parse(t)}).catch(function(){return{}})}},{key:"update",value:function(t,e){var n=this;if(this.runningUpdates.has(t))return this.runningUpdates.get(t);if(null!==this.runningClean)return this.runningClean.then(function(){return n.update(t,e)});var r=new Qn(e),o=this.needsUpdate(t,r).then(function(e){var o=e.needsUpdate,i=e.hasCache;return e.hasInternetConnexion?o?(console.log("Will update"),n._doUpdate(t,r)):(console.log("Skip update as it's valid"),!0):i?(console.warn("No Internet connexion"),!1):Promise.reject(new Error("No Internet connexion and no cache"))});return this.runningUpdates.set(t,o),o.then(function(){n.runningUpdates.delete(t)}),o}},{key:"needsUpdate",value:function(t,e){var n=new Qn(e);return Promise.all([this.getCacheMetadata(t),this.getLastPublishDate(t,n)]).then(function(t){var e=f(t,2),r=e[0],o=e[1],i=null!==r,s=null!==o,a=i?new Date(r.date):null;if(!s)return{needsUpdate:!i,lastPublishedDate:o,hasCache:i,hasInternetConnexion:s,lastCacheUpdateDate:a};var u=!1;return i?r.apiVersion!==b.getApiVersion()?u=!0:r.endpoint!==n.endpoint?u=!0:r.state!==n.state?u=!0:a<=o?u=!0:n.areSameAdditionalLocales(r.additionalLocales)&&n.areSameBinDownloadPolicy(r.binDownloadPolicy)||(u=!0):u=!0,{needsUpdate:u,lastPublishedDate:o,hasCache:i,hasInternetConnexion:s,lastCacheUpdateDate:a}})}},{key:"_getSiteCacheDirector",value:function(t){return this.directory+"/"+t}},{key:"_getBinCacheDirector",value:function(){return this.directory+"/bin"}},{key:"get",value:function(t,e){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=new b(e);return this.getCacheMetadata(o.site).then(function(t){if(null===t)return Promise.reject(new Error("CacheManager: no cache"));if(t.apiVersion!==b.getApiVersion())return Promise.reject(new Error("CacheManager: cache was created from another api version, please update it"));if(t.endpoint!==o.endpoint)return Promise.reject(new Error("CacheManager: cache was created from another endpoint, please update it"));if(t.state!==o.state)return Promise.reject(new Error("CacheManager: cache was created from state, please update it"));var e=null===o.locale||o===t.defaultLocale;return e||t.availableLocales.includes(o.locale)?r?e:n.getLastPublishDate(o.site,o).then(function(n){return null===n||n>new Date(t.date)?Promise.reject(new Error("CacheManger: is outdated")):e}):Promise.reject(new Error("CacheManager: requested locale is not in the cache"))}).then(function(e){var r=null;r=e||!n.constructor.getTranslatableRepositories().includes(t)?n._getSiteCacheDirector(o.site)+"/"+t+".json":n._getSiteCacheDirector(o.site)+"/"+o.locale+"/"+t+".json";var i=null;return t===Gt.getName()&&(i=n._getBinRegistry()),Promise.all([n._readFile(r).then(function(t){return JSON.parse(t)}),i])}).then(function(e){var r=f(e,2),i=r[0],s=r[1];if(t===Gt.getName()){var a=s[o.site];i.forEach(function(t){a.includes(t.reference)&&(t.uri=n._getBinCacheDirector()+"/"+t.reference)})}return i})}},{key:"_doUpdate",value:function(t,e){var n=this,r=this._createEm(t,null,e),o=[],i=this._getSiteCacheDirector(t);return r.load().then(function(){var i=r.getRepository("Site").getCurrent();null===r.locale&&(r.locale=i.locale);var s=null;null===e.additionalLocales?(s=[],i.languages.forEach(function(t){t!==i.locale&&s.push(t)})):s=e.additionalLocales;var a=[];return s.forEach(function(r){var i=n._createEm(t,r,e);o.push(i),n.constructor.getTranslatableRepositories().forEach(function(t){a.push(i.getRepository(t).load())})}),Promise.all(a)}).then(function(){return console.log("Cleaning"),n._rmrf(i)}).then(function(){console.log("Creating dirs");var t=[n._mkdirp(i),n._mkdirp(n._getBinCacheDirector())];return o.forEach(function(e){t.push(n._mkdirp(i+"/"+e.locale))}),console.log("Creating dir"),Promise.all(t)}).then(function(){var t,o={ignoredContexts:e.binDownloadPolicy.ignoredContexts,ignoredIds:[].concat(_(e.binDownloadPolicy.ignoredIds)),ignoredFileType:e.binDownloadPolicy.ignoredFileType},i=r.getRepository("MapFile").findBy({type:function(t){return[Ce.PATH,Ce.CONFIG,Ce.HELPER,Ce.IVE,Ce.LIGHT,Ce.OSG].includes(t)}}).map(function(t){return t.file.value});return(t=o.ignoredIds).push.apply(t,_(i)),n._downloadFiles(r,o)}).then(function(t){console.log("Saving");var e=[];return r.getRepositories().forEach(function(t){t.isLoaded()&&e.push(n._writeFile(i+"/"+t.constructor.getName()+".json",JSON.stringify(t.getAll())))}),o.forEach(function(t){t.getRepositories().forEach(function(r){r.isLoaded()&&e.push(n._writeFile(i+"/"+t.locale+"/"+r.constructor.getName()+".json",JSON.stringify(r.getAll())))})}),Promise.all(e).then(function(){return t})}).then(function(e){return n._cleanUnusedBins(t,e)}).then(function(){var t=r.getRepository("Site").getCurrent(),o={endpoint:e.endpoint,state:e.state,date:new Date,additionalLocales:e.additionalLocales,defaultLocale:t.default,availableLocales:Array.from(t.languages),binDownloadPolicy:e.binDownloadPolicy,apiVersion:b.getApiVersion()};return n._writeFile(i+"/metadata.json",JSON.stringify(o))})}},{key:"_downloadFiles",value:function(t,e){var n=this,r=[];if(t.getRepository("File").getAll().forEach(function(t){e.ignoredContexts.includes(t.context)||e.ignoredIds.includes(t.id)||e.ignoredFileType.includes(t.file_type)||r.push(t)}),0===r.length)return Promise.resolve([]);var o=[];r.forEach(function(t){o.includes(t.reference)||o.push(t.reference)});for(var i=[],s=0;s<10;s++)i.push(Promise.resolve());for(var a=function(t){var e=t%10;i[e]=i[e].then(function(){return n._downloadFile(r[t])})},u=0;u<r.length;u++)a(u);return Promise.all(i).then(function(){return o})}},{key:"_createEm",value:function(t,e,n){return new $n(new b({site:t,endpoint:n.endpoint,username:n.username,key:n.key,state:n.state,locale:e}))}},{key:"_downloadFile",value:function(t){return Promise.reject(new Error("Not implemented"))}},{key:"_exists",value:function(t){return Promise.reject(new Error("Not implemented"))}},{key:"_mkdirp",value:function(t){return Promise.reject(new Error("Not implemented"))}},{key:"_readFile",value:function(t){return Promise.reject(new Error("Not implemented"))}},{key:"_writeFile",value:function(t,e){return Promise.reject(new Error("Not implemented"))}},{key:"_rmrf",value:function(t){return Promise.reject(new Error("Not implemented"))}},{key:"_readdir",value:function(t){return Promise.reject(new Error("Not implemented"))}}]),t}(),tr=function(t){function e(){a(this,e);p(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,""));throw new Error("Not supported in browser")}return h(e,Zn),e}(),er=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"//localhost:8080/adsum/cache";return a(this,e),p(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t))}return h(e,Zn),u(e,[{key:"update",value:function(t,e){return Promise.reject(new Error("Not supported"))}},{key:"clean",value:function(t,e){return Promise.reject(new Error("Not supported"))}},{key:"_readFile",value:function(t){return mt.get(t).then(function(t){return"object"===s(t.data)?JSON.stringify(t.data):t.data})}}]),e}();t.EntityManager=$n,t.EventDispatcher=C,t.VERSION="2.1.0",t.Options=b,t.Request=$t,t.AbstractEntity=Mt,t.Category=an,t.Feature=ln,t.FeatureValue=hn,t.File=Gt,t.FILE_CONTEXTS=qt,t.FloorCalibration=yn,t.Place=gn,t.Playlist=mn,t.Site=Pn,t.SiteCalibration=bn,t.Tag=Cn,t.CustomObject=se,t.Picto=_e,t.Label=pe,t.Device=ve,t.Kiosk=we,t.Mobile=be,t.Web=Oe,t.MapAoDae=Ve,t.MapConfig=je,t.MapDae=Te,t.MapFile=Ee,t.MapHelper=Se,t.MapLight=Ne,t.MapPath=Re,t.Media=De,t.MediaImage=qe,t.MediaPdf=Je,t.MediaText=He,t.MediaUrl=We,t.MediaVideo=ze,t.Movie=Xe,t.Exhibitor=Qe,t.Person=Ze,t.Poi=Ye,t.Product=tn,t.Room=en,t.Service=nn,t.Store=rn,t.CUSTOM_OBJECT_ORIENTATION_MODES=ie,t.CUSTOM_OBJECT_TYPES=ae,t.LABEL_ALIGNMENTS=ue,t.DEVICE_TYPES=me,t.MAP_FILE_TYPES=Ce,t.MEDIA_TYPES=Be,t.POI_TYPES=$e,t.REPOSITORY_EVENTS=j,t.STATES=w,t.Reference=At,t.Collection=Ft,t.OrderedCollection=It,t.Vector=wt,t.LocalCacheManager=tr,t.DistCacheManager=er,t.CacheOptions=Qn,Object.defineProperty(t,"__esModule",{value:!0})});
